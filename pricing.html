<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pricing Plans - Free, Basic & Premium | Selira AI</title>
  <meta name="description" content="Choose the perfect Selira AI plan for you. Free trial, Engage, and Premium plans available with unlimited AI companions and conversations.">
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://selira.ai/pricing">
  <meta property="og:title" content="Pricing Plans - Selira AI">
  <meta property="og:description" content="Unlock unlimited AI companion experiences with our flexible pricing plans.">
  <meta property="og:image" content="https://selira.ai/og-image.jpg">
  
  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="https://selira.ai/pricing">
  <meta property="twitter:title" content="Pricing Plans | Selira AI">
  <meta property="twitter:description" content="Choose your perfect AI companion plan on Selira AI.">
  <meta property="twitter:image" content="https://selira.ai/og-image.jpg">
  
  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-XZXX201WKD"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-XZXX201WKD');
  </script>
  
  <!-- Auth0 Authentication System -->
  <script src="/js/auth0-login.js?v=4"></script>
  
  <!-- Selira AI Popup System -->
  <script src="/js/selira-popups.js"></script>
  
  <!-- Mobile Navigation System -->
  <script src="/js/mobile-nav.js"></script>
  
  <!-- Age Verification System -->
  <script src="/js/age-verification.js"></script>
  
  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="icon" type="image/svg+xml" href="favicon.svg">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap');
    
    :root {
      /* Selira dark theme - matching category.html */
      --bg-primary: #0a0a0a;
      --bg-secondary: #1a1a1a;
      --bg-tertiary: #2a2a2a;
      --bg-sidebar: #1a1a1a;
      --text-primary: #ffffff;
      --text-secondary: #b3b3b3;
      --text-muted: #888888;
      --accent: #d4a574;
      --accent-hover: #c19456;
      --accent-secondary: #ec4899;
      --border: #333333;
      --border-color: #333333;
      --success: #10b981;
      --error: #ef4444;
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background-color: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      overflow-x: hidden;
    }
    
    .app-container {
      display: flex;
      min-height: 100vh;
    }
    
    /* Left Sidebar Navigation (Character.AI style) */
    .sidebar {
      width: 220px;
      background: var(--bg-sidebar);
      border-right: none;
      padding: 16px;
      display: flex;
      flex-direction: column;
      position: fixed;
      height: 100vh;
      left: 0;
      top: 0;
      z-index: 100;
      overflow-y: auto;
    }
    
    .sidebar-logo {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      text-decoration: none;
      color: inherit;
      transition: opacity 0.2s ease;
    }

    .sidebar-logo:hover {
      opacity: 0.8;
      text-decoration: none;
      color: inherit;
    }

    .sidebar-logo-text {
      font-family: 'Playfair Display', serif;
      font-size: 16px;
      font-weight: 700;
      color: var(--accent);
    }

    .sidebar-nav {
      flex: 1;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 10px;
      margin-bottom: 2px;
      color: rgba(255, 255, 255, 0.8);
      text-decoration: none;
      border-radius: var(--radius-sm);
      transition: all 0.2s ease;
      font-weight: 500;
      font-size: 13px;
    }

    .nav-item:hover, .nav-item.active {
      background: rgba(255, 255, 255, 0.1);
      color: white;
    }

    .nav-item-icon {
      font-size: 14px;
      width: 14px;
      text-align: center;
    }

    .nav-section-title {
      font-size: 9px;
      font-weight: 700;
      color: rgba(255, 255, 255, 0.6);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin: 12px 0 4px;
      padding: 0 10px;
    }
    
    /* Main Content Area */
    .main-content {
      flex: 1;
      margin-left: 220px;
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow-y: auto;
    }
    
    /* Mobile Header (hidden on desktop) */
    .mobile-header {
      display: none;
      justify-content: space-between;
      align-items: center;
      padding: 16px 20px;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 0;
      z-index: 50;
    }
    
    .mobile-menu-btn {
      background: none;
      border: none;
      color: var(--text-primary);
      font-size: 20px;
      cursor: pointer;
      padding: 8px;
      border-radius: var(--radius-sm);
      transition: background 0.2s ease;
    }
    
    .mobile-menu-btn:hover {
      background: var(--bg-tertiary);
    }
    
    .mobile-logo {
      font-family: 'Playfair Display', serif;
      font-size: 20px;
      font-weight: 700;
      color: var(--accent);
    }
    
    /* Top Header (Character.AI style) */
    .top-header {
      background: var(--bg-primary);
      border-bottom: 1px solid var(--border-color);
      position: sticky;
      top: 0;
      z-index: 40;
    }
    
    .header-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 40px;
      gap: 24px;
    }
    
    /* Search */
    .search-container {
      position: relative;
      flex: 1;
      max-width: 600px;
    }
    
    .search-icon {
      position: absolute;
      left: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-muted);
      font-size: 16px;
      cursor: pointer;
      transition: color 0.2s ease;
    }

    .search-icon:hover {
      color: var(--accent);
    }
    
    .search-input {
      width: 100%;
      padding: 10px 16px 10px 48px;
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      color: var(--text-primary);
      font-size: 13px;
      outline: none;
      transition: border-color 0.2s ease;
    }
    
    .search-input:focus {
      border-color: var(--accent);
    }
    
    .search-input::placeholder {
      color: var(--text-muted);
    }
    
    /* User Actions */
    .user-actions {
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .dropdown-btn {
      background: none;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      padding: 6px 10px;
      border-radius: var(--radius-sm);
      transition: all 0.2s ease;
    }
    
    .dropdown-btn:hover {
      background: var(--bg-secondary);
      color: var(--text-primary);
    }
    
    .user-btn {
      padding: 8px 16px;
      border-radius: var(--radius-md);
      text-decoration: none;
      font-weight: 600;
      font-size: 13px;
      transition: all 0.2s ease;
      border: 1px solid transparent;
    }
    
    .user-btn.secondary {
      color: var(--text-secondary);
      border-color: var(--border);
    }
    
    .user-btn.secondary:hover {
      background: var(--bg-secondary);
      color: var(--text-primary);
    }
    
    .signup-btn {
      background: var(--accent);
      color: white;
    }
    
    .signup-btn:hover {
      background: var(--accent-hover);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(212, 165, 116, 0.3);
    }
    
    /* Pricing Section */
    .pricing-section {
      padding: 32px 40px;
      max-width: 1400px;
      margin: 0 auto;
    }
    
    /* Tab Navigation */
    .pricing-tabs {
      display: flex;
      justify-content: center;
      margin-bottom: 40px;
      background: var(--bg-secondary);
      border-radius: var(--radius-md);
      padding: 4px;
      max-width: 400px;
      margin-left: auto;
      margin-right: auto;
      margin-bottom: 40px;
    }
    
    .tab-button {
      flex: 1;
      padding: 12px 24px;
      background: none;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      border-radius: var(--radius-sm);
      font-weight: 500;
      font-size: 13px;
      transition: all 0.2s ease;
    }
    
    .tab-button.active {
      background: var(--accent);
      color: white;
    }
    
    .tab-button:hover:not(.active) {
      color: var(--text-primary);
      background: var(--bg-tertiary);
    }
    
    /* Tab Content */
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    /* Pricing Cards */
    .pricing-cards {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 32px;
      margin-bottom: 40px;
      max-width: 1200px;
      margin-left: auto;
      margin-right: auto;
      padding: 0;
    }
    
    .pricing-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: 32px 24px;
      position: relative;
      transition: all 0.3s ease;
      min-height: 500px;
      display: flex;
      flex-direction: column;
    }
    
    .pricing-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.3);
    }
    
    .pricing-card.featured {
      border-color: var(--accent);
      transform: scale(1.02);
    }
    
    .pricing-card.featured:hover {
      transform: scale(1.02) translateY(-4px);
    }

    .pricing-card.current-plan {
      border-color: #10b981;
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, var(--bg-secondary) 100%);
    }

    .current-plan-badge {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      font-size: 12px;
      font-weight: 600;
      padding: 4px 12px;
      border-radius: 12px;
      position: absolute;
      top: -8px;
      left: 50%;
      transform: translateX(-50%);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      z-index: 2;
    }

    .card-badge {
      position: absolute;
      top: -10px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--accent);
      color: white;
      padding: 6px 16px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      z-index: 1;
    }

    /* Adjust badge positioning when both are present - stack vertically with more spacing */
    .pricing-card.featured.current-plan .card-badge {
      top: -10px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1;
    }

    .pricing-card.featured.current-plan .current-plan-badge {
      top: 18px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 2;
    }
    
    .plan-name {
      font-family: 'Playfair Display', serif;
      font-size: 24px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 12px;
    }
    
    .plan-price {
      display: flex;
      align-items: baseline;
      gap: 4px;
      margin-bottom: 8px;
    }
    
    .price-currency {
      font-size: 18px;
      font-weight: 600;
      color: var(--accent);
    }
    
    .price-amount {
      font-size: 32px;
      font-weight: 700;
      color: var(--accent);
    }
    
    .price-period {
      font-size: 16px;
      color: var(--text-secondary);
    }
    
    .price-daily {
      color: var(--text-secondary);
      font-size: 13px;
      margin-bottom: 16px;
    }
    
    .plan-description {
      color: var(--text-secondary);
      font-size: 13px;
      margin-bottom: 24px;
    }
    
    .plan-features {
      list-style: none;
      margin-bottom: 32px;
      flex-grow: 1;
    }
    
    .feature-item {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
      color: var(--text-primary);
      font-size: 13px;
    }
    
    .feature-icon {
      color: var(--success);
      font-weight: 700;
      width: 16px;
    }
    
    .plan-button {
      width: 100%;
      padding: 14px 24px;
      background: var(--accent);
      color: white;
      border: none;
      border-radius: var(--radius-md);
      font-weight: 600;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
      text-align: center;
      display: block;
    }
    
    .plan-button:hover {
      background: var(--accent-hover);
      transform: translateY(-1px);
    }
    
    .plan-button.secondary {
      background: transparent;
      color: var(--text-primary);
      border: 1px solid var(--border);
    }
    
    .plan-button.secondary:hover {
      background: var(--bg-tertiary);
    }
    
    /* Responsive Design */
    @media (max-width: 1024px) {
      .pricing-cards {
        grid-template-columns: 1fr;
        gap: 24px;
      }
      
      .pricing-section {
        padding: 24px 20px;
      }
    }
    
    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
        transition: transform 0.3s ease;
      }

      .sidebar.open {
        transform: translateX(0);
      }

      .main-content {
        margin-left: 0;
      }

      .mobile-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 16px 20px;
        background: var(--bg-primary);
        border-bottom: 1px solid var(--border);
        position: sticky;
        top: 0;
        z-index: 100;
        height: 60px;
        box-sizing: border-box;
      }

      .mobile-menu-btn {
        background: none;
        border: none;
        font-size: 24px;
        color: var(--text-primary);
        cursor: pointer;
        padding: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
      }

      .mobile-logo {
        font-family: 'Playfair Display', serif;
        font-size: 20px;
        font-weight: 700;
        color: var(--accent);
        flex-grow: 1;
        text-align: center;
        margin: 0 16px;
      }

      .top-header {
        display: none;
      }
      
      .header-top {
        padding: 16px 20px;
        flex-direction: column;
        gap: 16px;
      }
      
      .search-container {
        order: 2;
        max-width: none;
      }
      
      .user-actions {
        order: 1;
        justify-content: center;
        width: 100%;
      }
      
      .pricing-section {
        padding: 20px 16px;
      }
      
      .pricing-card {
        min-height: auto;
        padding: 24px 20px;
      }
      
      .pricing-card.featured {
        transform: scale(1);
      }
      
      .plan-name {
        font-size: 20px;
      }
      
      .price-amount {
        font-size: 28px;
      }
    }
    
    /* Sidebar Overlay for Mobile */
    .sidebar-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 99;
    }
    
    .sidebar-overlay.open {
      display: block;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .pricing-section {
      animation: fadeIn 0.6s ease;
    }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- Left Sidebar Navigation -->
    <aside class="sidebar" id="sidebar">
      <!-- Logo -->
      <a href="/" class="sidebar-logo">
        <div class="sidebar-logo-text">Selira AI</div>
      </a>

      <!-- Navigation -->
      <nav class="sidebar-nav">
        <a href="/" class="nav-item">
          <span class="nav-item-icon">👥</span>
          <span>Discover</span>
        </a>
        <a href="/my-companions" class="nav-item">
          <span class="nav-item-icon">💬</span>
          <span>My Companions</span>
        </a>
        <a href="/create" class="nav-item">
          <span class="nav-item-icon">➕</span>
          <span>Create</span>
        </a>

        <div class="nav-section-title">Account</div>

        <a href="/profile" class="nav-item">
          <span class="nav-item-icon">👤</span>
          <span>Profile</span>
        </a>
        <a href="/pricing" class="nav-item active">
          <span class="nav-item-icon">💎</span>
          <span>Pricing</span>
        </a>
      </nav>
    </aside>

    <!-- Sidebar Overlay for Mobile -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Mobile Header -->
      <div class="mobile-header">
        <button class="mobile-menu-btn" onclick="toggleSidebar()">☰</button>
        <div class="mobile-logo">Selira AI</div>
      </div>

      <!-- Top Header -->
      <header class="top-header">
        <div class="header-top">
          <!-- Search -->
          <div class="search-container">
            <div class="search-icon">🔍</div>
            <input 
              type="text" 
              class="search-input" 
              placeholder="Search"
              id="searchInput"
            >
          </div>

          <!-- User Actions -->
          <div class="user-actions">
            <select class="dropdown-btn" style="border: none; background: none; color: var(--text-secondary);">
              <option>English</option>
            </select>
            <a href="#" class="user-btn secondary login-btn" onclick="openLoginModal('login'); return false;">Sign In</a>
            <a href="#" class="user-btn signup-btn" onclick="openLoginModal('signup'); return false;">Register</a>
          </div>
        </div>
      </header>

      <!-- Pricing Section -->
      <section class="pricing-section">
        <!-- Tab Navigation -->
        <div class="pricing-tabs">
          <button class="tab-button active" onclick="switchTab('subscriptions')">Subscription Plans</button>
          <button class="tab-button" onclick="switchTab('oneoff')">One-off Purchases</button>
        </div>

        <!-- Subscription Plans Tab -->
        <div class="tab-content active" id="subscriptions-tab">
          <div class="pricing-cards">
          <!-- Free -->
          <div class="pricing-card">
            <div class="plan-name">Free</div>
            <div class="plan-price">
              <span class="price-currency">$</span>
              <span class="price-amount">0</span>
              <span class="price-period">/month</span>
            </div>
            <div class="plan-description">Everything you need to get started with AI companions</div>

            <ul class="plan-features">
              <li class="feature-item">
                <span class="feature-icon">✓</span>
                <span>Unlimited messaging</span>
              </li>
              <li class="feature-item">
                <span class="feature-icon">✓</span>
                <span>Unlimited companions</span>
              </li>
              <li class="feature-item">
                <span class="feature-icon">✓</span>
                <span>Unlimited memories</span>
              </li>
              <li class="feature-item">
                <span class="feature-icon">✓</span>
                <span>No ads</span>
              </li>
              <li class="feature-item">
                <span class="feature-icon">✗</span>
                <span>No image generation</span>
              </li>
            </ul>

            <a href="#" class="plan-button secondary" onclick="handlePlanClick('free'); return false;">Start Free</a>
          </div>

          <!-- Basic Plan -->
          <div class="pricing-card">
            <div class="plan-name">Basic</div>
            <div class="plan-price">
              <span class="price-currency">$</span>
              <span class="price-amount">9.99</span>
              <span class="price-period">/month</span>
            </div>
            <div class="plan-description">Everything in Free plus AI image generation</div>

            <ul class="plan-features">
              <li class="feature-item">
                <span class="feature-icon">✓</span>
                <span>Unlimited messaging</span>
              </li>
              <li class="feature-item">
                <span class="feature-icon">✓</span>
                <span>Unlimited companions</span>
              </li>
              <li class="feature-item">
                <span class="feature-icon">✓</span>
                <span>Unlimited memories</span>
              </li>
              <li class="feature-item">
                <span class="feature-icon">✓</span>
                <span>No ads</span>
              </li>
              <li class="feature-item">
                <span class="feature-icon">✓</span>
                <span>10 images generated per hour</span>
              </li>
            </ul>

            <a href="#" class="plan-button" onclick="handlePlanClick('basic'); return false;">Choose Basic</a>
          </div>

          <!-- Premium Plan -->
          <div class="pricing-card featured">
            <div class="card-badge">Most Popular</div>
            <div class="plan-name">Premium</div>
            <div class="plan-price">
              <span class="price-currency">$</span>
              <span class="price-amount">19.99</span>
              <span class="price-period">/month</span>
            </div>
            <div class="plan-description">The ultimate AI companion experience</div>

            <ul class="plan-features">
              <li class="feature-item">
                <span class="feature-icon">✓</span>
                <span>Unlimited messaging</span>
              </li>
              <li class="feature-item">
                <span class="feature-icon">✓</span>
                <span>Unlimited companions</span>
              </li>
              <li class="feature-item">
                <span class="feature-icon">✓</span>
                <span>Unlimited memories</span>
              </li>
              <li class="feature-item">
                <span class="feature-icon">✓</span>
                <span>No ads</span>
              </li>
              <li class="feature-item">
                <span class="feature-icon">✓</span>
                <span>20 images generated per hour</span>
              </li>
              <li class="feature-item">
                <span class="feature-icon">✓</span>
                <span>Access to special companions</span>
              </li>
            </ul>

            <a href="#" class="plan-button" onclick="handlePlanClick('premium'); return false;">Choose Premium</a>
          </div>
        </div>
        </div>

        <!-- One-off Purchases Tab -->
        <div class="tab-content" id="oneoff-tab">
          <div style="text-align: center; padding: 60px 20px;">
            <h2 style="font-family: 'Playfair Display', serif; font-size: 32px; margin-bottom: 16px;">Coming Soon</h2>
            <p style="color: var(--text-secondary); font-size: 18px;">One-off purchase options will be available soon.</p>
          </div>
          <div class="pricing-cards" style="display: none;">
            <!-- 50 Messages -->
            <div class="pricing-card">
              <div class="plan-name">50 Messages</div>
              <div class="plan-price">
                <span class="price-currency">$</span>
                <span class="price-amount">2.99</span>
              </div>
              <div class="plan-description">Perfect for occasional chats with your AI companions</div>
              
              <ul class="plan-features">
                <li class="feature-item">
                  <span class="feature-icon">✓</span>
                  <span>50 chat messages</span>
                </li>
                <li class="feature-item">
                  <span class="feature-icon">✓</span>
                  <span>Access to all companions</span>
                </li>
                <li class="feature-item">
                  <span class="feature-icon">✓</span>
                  <span>Basic memory</span>
                </li>
                <li class="feature-item">
                  <span class="feature-icon">✓</span>
                  <span>30 days to use</span>
                </li>
              </ul>
              
              <a href="#" class="plan-button">Buy 50 Messages</a>
            </div>

            <!-- 200 Messages -->
            <div class="pricing-card featured">
              <div class="card-badge">Best Value</div>
              <div class="plan-name">200 Messages</div>
              <div class="plan-price">
                <span class="price-currency">$</span>
                <span class="price-amount">9.99</span>
              </div>
              <div class="price-daily">Only $0.05/message</div>
              <div class="plan-description">Great for regular conversations throughout the month</div>
              
              <ul class="plan-features">
                <li class="feature-item">
                  <span class="feature-icon">✓</span>
                  <span>200 chat messages</span>
                </li>
                <li class="feature-item">
                  <span class="feature-icon">✓</span>
                  <span>Access to all companions</span>
                </li>
                <li class="feature-item">
                  <span class="feature-icon">✓</span>
                  <span>5 voice chats included</span>
                </li>
                <li class="feature-item">
                  <span class="feature-icon">✓</span>
                  <span>Enhanced memory</span>
                </li>
                <li class="feature-item">
                  <span class="feature-icon">✓</span>
                  <span>60 days to use</span>
                </li>
              </ul>
              
              <a href="#" class="plan-button">Buy 200 Messages</a>
            </div>

            <!-- 500 Messages -->
            <div class="pricing-card">
              <div class="card-badge" style="background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);">Power User</div>
              <div class="plan-name">500 Messages</div>
              <div class="plan-price">
                <span class="price-currency">$</span>
                <span class="price-amount">19.99</span>
              </div>
              <div class="price-daily">Only $0.04/message</div>
              <div class="plan-description">For heavy users who want maximum flexibility</div>
              
              <ul class="plan-features">
                <li class="feature-item">
                  <span class="feature-icon">✓</span>
                  <span>500 chat messages</span>
                </li>
                <li class="feature-item">
                  <span class="feature-icon">✓</span>
                  <span>Access to all companions</span>
                </li>
                <li class="feature-item">
                  <span class="feature-icon">✓</span>
                  <span>15 voice chats included</span>
                </li>
                <li class="feature-item">
                  <span class="feature-icon">✓</span>
                  <span>Premium memory system</span>
                </li>
                <li class="feature-item">
                  <span class="feature-icon">✓</span>
                  <span>90 days to use</span>
                </li>
                <li class="feature-item">
                  <span class="feature-icon">✓</span>
                  <span>Priority support</span>
                </li>
              </ul>
              
              <a href="#" class="plan-button">Buy 500 Messages</a>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    // Mobile sidebar toggle
    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('sidebarOverlay');

      sidebar.classList.toggle('open');
      overlay.classList.toggle('open');
    }

    // Initialize search functionality
    document.addEventListener('DOMContentLoaded', function() {
      const searchInput = document.getElementById('searchInput');
      if (searchInput) {
        searchInput.addEventListener('keyup', function(e) {
          if (e.key === 'Enter' && this.value.trim()) {
            window.location.href = `/search-results?q=${encodeURIComponent(this.value.trim())}`;
          }
        });

        // Also add click listener to search icon
        const searchIcon = document.querySelector('.search-icon');
        if (searchIcon) {
          searchIcon.addEventListener('click', function() {
            const query = searchInput.value.trim();
            if (query) {
              window.location.href = `/search-results?q=${encodeURIComponent(query)}`;
            }
          });
        }
      }
    });
    
    // Close sidebar when clicking overlay
    document.getElementById('sidebarOverlay').addEventListener('click', function() {
      toggleSidebar();
    });
    
    // Navigation functions for consistency with /category
    function showMyCompanions() {
      window.location.href = '/category';
    }
    
    function showCreateCharacter() {
      window.location.href = '/create';
    }
    
    // Tab switching functionality
    function switchTab(tabName) {
      // Remove active class from all tabs and tab buttons
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });
      document.querySelectorAll('.tab-button').forEach(button => {
        button.classList.remove('active');
      });
      
      // Add active class to selected tab and button
      document.getElementById(tabName + '-tab').classList.add('active');
      event.target.classList.add('active');
    }
    
    // Handle plan button clicks
    function handlePlanClick(planType) {
      console.log('🚀 handlePlanClick called with planType:', planType);

      // PRIORITY CHECK: Premium -> Basic downgrade
      if (planType === 'basic') {
        // Check if user is currently on Premium
        const premiumCard = document.querySelector('.pricing-card:nth-child(3)');
        const basicButton = document.querySelector('.pricing-card:nth-child(2) .plan-button');

        console.log('🔍 Checking for Premium -> Basic downgrade:', {
          premiumCardExists: !!premiumCard,
          premiumHasCurrentPlan: premiumCard ? premiumCard.classList.contains('current-plan') : false,
          basicButtonExists: !!basicButton,
          basicButtonText: basicButton ? basicButton.textContent : 'N/A'
        });

        if (premiumCard && premiumCard.classList.contains('current-plan')) {
          console.log('🎯 PREMIUM -> BASIC DOWNGRADE DETECTED (current-plan class) - bypassing normal flow');
          downgradePlan(planType);
          return;
        }

        if (basicButton && basicButton.textContent.includes('Downgrade to Basic')) {
          console.log('🎯 PREMIUM -> BASIC DOWNGRADE DETECTED (button text) - bypassing normal flow');
          downgradePlan(planType);
          return;
        }
      }

      // Check if user is logged in
      const isLoggedIn = localStorage.getItem('auth0_token') || localStorage.getItem('user_uid');

      if (!isLoggedIn) {
        // User is not logged in - show registration popup
        if (typeof openLoginModal === 'function') {
          openLoginModal('signup');
        } else {
          // Fallback if auth0-login.js is not loaded
          alert('Please sign up to choose a plan');
        }
        return;
      }

      // User is logged in - handle based on plan type
      if (planType === 'free') {
        // Free plan - check if it's a downgrade
        // First check if we have current plan info, if not, try to load it
        if (window.currentUserPlan === undefined) {
          // Plan not loaded yet - load it first then handle the click
          loadCurrentPlan().then(() => {
            // After loading, check again
            if (window.currentUserPlan && window.currentUserPlan !== 'free') {
              downgradeToFree();
            } else {
              // Already free or couldn't determine plan - redirect to category page
              window.location.href = '/category';
            }
          }).catch(() => {
            // If loading fails, assume they want to downgrade and show the process
            downgradeToFree();
          });
        } else if (window.currentUserPlan && window.currentUserPlan !== 'free') {
          downgradeToFree();
        } else {
          // Already free or new user - redirect to category page
          window.location.href = '/category';
        }
      } else {
        // Paid plans - check if this is an upgrade or downgrade
        handlePaidPlanSelection(planType);
      }
    }

    // Handle paid plan selection (upgrade or downgrade)
    async function handlePaidPlanSelection(planType) {
      try {
        console.log('🔄 Starting plan selection for:', planType);
        console.log('🔍 Current window.currentUserPlan:', window.currentUserPlan);

        // Try to determine current plan from button text as fallback
        let detectedCurrentPlan = 'free';

        // Check if any pricing card has "current plan" styling
        const currentPlanCard = document.querySelector('.pricing-card.current-plan');
        if (currentPlanCard) {
          const planName = currentPlanCard.querySelector('.plan-name');
          if (planName) {
            detectedCurrentPlan = planName.textContent.toLowerCase();
            console.log('🔍 Detected current plan from UI:', detectedCurrentPlan);
          }
        }

        // Also check button texts for downgrade clues
        const basicButton = document.querySelector('.pricing-card:nth-child(2) .plan-button');
        const premiumButton = document.querySelector('.pricing-card:nth-child(3) .plan-button');

        if (basicButton && basicButton.textContent.includes('Downgrade to Basic')) {
          detectedCurrentPlan = 'premium';
          console.log('🔍 Detected premium plan from Basic downgrade button');
        } else if (premiumButton && premiumButton.textContent.includes('Downgrade to Premium')) {
          // This shouldn't happen, but just in case
          console.log('🔍 Unusual: detected downgrade to premium');
        }

        // Always load current plan to get the most up-to-date info
        console.log('🔄 Loading current plan...');
        await loadCurrentPlan();

        // Use the loaded plan, fallback to detected plan
        const currentPlan = window.currentUserPlan || detectedCurrentPlan;
        const planHierarchy = { 'free': 0, 'basic': 1, 'premium': 2 };

        console.log('🔄 Plan comparison:', {
          currentPlan,
          detectedCurrentPlan,
          targetPlan: planType,
          currentLevel: planHierarchy[currentPlan],
          targetLevel: planHierarchy[planType],
          isUpgrade: planHierarchy[planType] > planHierarchy[currentPlan],
          isDowngrade: planHierarchy[planType] < planHierarchy[currentPlan],
          isSame: planHierarchy[planType] === planHierarchy[currentPlan]
        });

        // For Premium -> Basic specifically, force downgrade logic
        if (currentPlan === 'premium' && planType === 'basic') {
          console.log('🎯 FORCED DOWNGRADE: Premium -> Basic detected');
          await downgradePlan(planType);
          return;
        }

        // Determine if this is an upgrade or downgrade
        if (planHierarchy[planType] > planHierarchy[currentPlan]) {
          // This is an upgrade - use Stripe checkout
          console.log('✅ Upgrade detected - using Stripe checkout');
          initiateStripeCheckout(planType);
        } else if (planHierarchy[planType] < planHierarchy[currentPlan]) {
          // This is a downgrade - use subscription downgrade
          console.log('✅ Downgrade detected - using subscription update');
          await downgradePlan(planType);
        } else {
          // Same plan - shouldn't happen but handle gracefully
          console.log('⚠️ Same plan selected');
          alert('You are already on this plan');
        }

      } catch (error) {
        console.error('❌ Error handling plan selection:', error);
        // Fallback to Stripe checkout if we can't determine current plan
        console.log('🔄 Falling back to Stripe checkout due to error');
        initiateStripeCheckout(planType);
      }
    }

    // Downgrade to a paid plan (Premium -> Basic)
    async function downgradePlan(targetPlan) {
      const confirmMessage = `Are you sure you want to downgrade to the ${targetPlan.charAt(0).toUpperCase() + targetPlan.slice(1)} plan?\n\nYour subscription will be updated immediately and you can continue using your current plan benefits until your next billing date.`;

      if (!confirm(confirmMessage)) {
        return;
      }

      // Delay to ensure confirm dialog is fully closed before showing success message
      const showSuccessMessage = (message) => {
        setTimeout(() => {
          alert(message);
        }, 500);
      };

      try {
        const user = window.getCurrentUser();
        if (!user) {
          showSuccessMessage('Please log in to manage your subscription');
          return;
        }

        console.log('🔄 Downgrading to', targetPlan, 'for user:', user.email);

        // Show loading state on the target plan button
        const targetCard = document.querySelector(`.pricing-card:nth-child(${targetPlan === 'basic' ? '2' : '3'})`);
        const targetButton = targetCard ? targetCard.querySelector('.plan-button') : null;
        if (targetButton) {
          const originalText = targetButton.textContent;
          targetButton.textContent = 'Processing...';
          targetButton.style.opacity = '0.7';
        }

        // Call the manage subscription function with downgrade action
        const requestData = {
          action: 'downgrade_plan',
          targetPlan: targetPlan,
          userEmail: user.email,
          auth0Id: user.sub
        };

        console.log('🔄 Sending downgrade request:', requestData);

        const response = await fetch('/.netlify/functions/selira-manage-subscription', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(requestData)
        });

        console.log('📊 Response status:', response.status);

        let result;
        try {
          result = await response.json();
        } catch (jsonError) {
          console.error('❌ Failed to parse response as JSON:', jsonError);
          const textResponse = await response.text();
          console.error('❌ Raw response:', textResponse);
          showSuccessMessage(`Server error: Unable to parse response. Status: ${response.status}`);
          return;
        }

        console.log('📋 Parsed result:', result);

        if (response.ok && result.success) {
          console.log('✅ Plan downgrade successful:', result);

          let successMessage = `Plan downgraded to ${targetPlan.charAt(0).toUpperCase() + targetPlan.slice(1)} successfully!`;

          if (result.next_billing_date) {
            successMessage += `\n\nYou can continue to use your current plan benefits until ${result.next_billing_date}`;
          }

          showSuccessMessage(successMessage);

          // Reload the current plan display
          await loadCurrentPlan();

        } else {
          console.error('❌ Downgrade failed:', result);
          let alertMessage = `Failed to downgrade plan: ${result.error || 'Unknown error'}`;

          if (result.details) {
            alertMessage += `\n\nDetails: ${result.details}`;
          }

          showSuccessMessage(alertMessage);
        }

        // Restore button state
        if (targetButton) {
          targetButton.textContent = `Downgrade to ${targetPlan.charAt(0).toUpperCase() + targetPlan.slice(1)}`;
          targetButton.style.opacity = '1';
        }

      } catch (error) {
        console.error('❌ Error downgrading plan:', error);
        showSuccessMessage('An error occurred while downgrading your plan. Please try again.');

        // Restore button state
        const targetCard = document.querySelector(`.pricing-card:nth-child(${targetPlan === 'basic' ? '2' : '3'})`);
        const targetButton = targetCard ? targetCard.querySelector('.plan-button') : null;
        if (targetButton) {
          targetButton.textContent = `Downgrade to ${targetPlan.charAt(0).toUpperCase() + targetPlan.slice(1)}`;
          targetButton.style.opacity = '1';
        }
      }
    }

    // Initiate Stripe checkout for paid plans
    async function initiateStripeCheckout(planType) {
      try {
        // Map plan types to Stripe price IDs
        const priceIds = {
          'basic': 'price_1S9KVADEKVIZZyJVXXjE2gYE',
          'premium': 'price_1S9KVbDEKVIZZyJVDpWlXYhb'
        };

        const priceId = priceIds[planType];
        if (!priceId) {
          console.error('Invalid plan type:', planType);
          alert('Invalid plan selected');
          return;
        }

        // Get user info
        const userEmail = localStorage.getItem('user_email');
        const userId = localStorage.getItem('user_uid');

        if (!userEmail || !userId) {
          console.error('Missing user information');
          alert('Please log in again to continue');
          window.location.href = '/';
          return;
        }

        // Create Stripe checkout session
        const response = await fetch('/.netlify/functions/selira-create-checkout-session', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            priceId: priceId,
            userEmail: userEmail,
            userId: userId,
            planName: planType,
            successUrl: window.location.origin + '/profile?payment=success',
            cancelUrl: window.location.origin + '/pricing'
          })
        });

        if (!response.ok) {
          const error = await response.json();
          console.error('Checkout session error:', error);
          alert('Unable to start checkout process. Please try again.');
          return;
        }

        const { sessionUrl } = await response.json();

        if (sessionUrl) {
          // Redirect to Stripe checkout
          window.location.href = sessionUrl;
        } else {
          console.error('No session URL received');
          alert('Unable to start checkout process. Please try again.');
        }

      } catch (error) {
        console.error('Error initiating checkout:', error);
        alert('An error occurred. Please try again later.');
      }
    }

    // Downgrade to free plan
    async function downgradeToFree() {
      const confirmMessage = 'Are you sure you want to downgrade to the Free plan?\n\nYour current subscription will be canceled at the end of your current billing period, and you will keep access until then.';

      if (!confirm(confirmMessage)) {
        return;
      }

      // Delay to ensure confirm dialog is fully closed before showing success message
      const showSuccessMessage = (message) => {
        setTimeout(() => {
          alert(message);
        }, 500); // Increased delay to prevent overlap
      };

      try {
        const user = window.getCurrentUser();
        if (!user) {
          showSuccessMessage('Please log in to manage your subscription');
          return;
        }

        console.log('🔄 Downgrading to free plan for user:', user.email);

        // Show loading state
        const freeButton = document.querySelector('.pricing-card:nth-child(1) .plan-button');
        if (freeButton) {
          const originalText = freeButton.textContent;
          freeButton.textContent = 'Processing...';
          freeButton.style.opacity = '0.7';
        }

        // Call the manage subscription function with cancel_at_period_end action
        const requestData = {
          action: 'cancel_at_period_end',
          userEmail: user.email,
          auth0Id: user.sub
        };

        console.log('🔄 Sending downgrade request:', requestData);

        const response = await fetch('/.netlify/functions/selira-manage-subscription', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(requestData)
        });

        console.log('📊 Response status:', response.status);
        console.log('📊 Response ok:', response.ok);

        let result;
        try {
          result = await response.json();
        } catch (jsonError) {
          console.error('❌ Failed to parse response as JSON:', jsonError);
          const textResponse = await response.text();
          console.error('❌ Raw response:', textResponse);
          showSuccessMessage(`Server error: Unable to parse response. Status: ${response.status}`);
          return;
        }

        console.log('📋 Parsed result:', result);

        if (response.ok && result.success) {
          console.log('✅ Subscription downgrade successful:', result);

          // Use delayed success message
          showSuccessMessage(`Subscription canceled successfully!\n\nYou will keep access to your current plan until ${result.cancels_at || 'the end of your billing period'}, after which you will be automatically switched to the Free plan.`);

          // Reload the current plan display
          await loadCurrentPlan();

        } else {
          console.error('❌ Downgrade failed:', result);
          let alertMessage = `Failed to downgrade subscription: ${result.error || 'Unknown error'}\n\nDetails: ${result.details || 'No additional details'}`;

          if (result.debugInfo) {
            console.log('🔍 Debug info:', result.debugInfo);
            alertMessage += `\n\nDebug Info:\nUser Plan: ${result.debugInfo.userPlan || 'Unknown'}\nAvailable Fields: ${result.debugInfo.availableFields ? result.debugInfo.availableFields.join(', ') : 'None'}\nStripe Fields: ${result.debugInfo.stripeFields ? result.debugInfo.stripeFields.join(', ') : 'None'}`;
          }

          showSuccessMessage(alertMessage);
        }

        // Restore button state
        if (freeButton) {
          freeButton.textContent = 'Downgrade to Free';
          freeButton.style.opacity = '1';
        }

      } catch (error) {
        console.error('❌ Error downgrading subscription:', error);
        showSuccessMessage('An error occurred while downgrading your subscription. Please try again.');

        // Restore button state
        const freeButton = document.querySelector('.pricing-card:nth-child(1) .plan-button');
        if (freeButton) {
          freeButton.textContent = 'Downgrade to Free';
          freeButton.style.opacity = '1';
        }
      }
    }

    // Load current subscription info
    async function loadCurrentPlan() {
      try {
        // Check if user is authenticated using the existing window functions
        if (!window.isUserAuthenticated || !window.isUserAuthenticated()) {
          console.log('🔄 User not authenticated, setting plan to free');
          window.currentUserPlan = 'free';
          return;
        }

        const user = window.getCurrentUser();
        if (!user) {
          console.log('🔄 No user data available, setting plan to free');
          window.currentUserPlan = 'free';
          return;
        }

        console.log('🔄 Loading current plan for user:', user.email);

        const response = await fetch(`/.netlify/functions/selira-get-subscription-info?email=${encodeURIComponent(user.email)}&auth0_id=${encodeURIComponent(user.sub)}`);
        const data = await response.json();

        if (data.success && data.subscription) {
          console.log('✅ Current plan loaded:', data.subscription.plan);
          updatePricingDisplay(data.subscription);
        } else {
          // No subscription found - user is on free plan
          console.log('✅ No subscription found - user is on free plan');
          window.currentUserPlan = 'free';
        }
      } catch (error) {
        console.error('❌ Error loading current plan:', error);
        // Set to free plan as fallback
        window.currentUserPlan = 'free';
      }
    }

    // Update pricing cards to show current plan
    function updatePricingDisplay(subscription) {
      // Set global variable for current plan
      window.currentUserPlan = (subscription.plan || 'Free').toLowerCase();
      window.currentSubscription = subscription;

      // Remove all current plan indicators and remaining time displays
      document.querySelectorAll('.pricing-card').forEach(card => {
        card.classList.remove('current-plan');
        const badge = card.querySelector('.current-plan-badge');
        if (badge) badge.remove();
        const timeRemaining = card.querySelector('.time-remaining');
        if (timeRemaining) timeRemaining.remove();
      });

      // Find and highlight the current plan
      const currentPlan = window.currentUserPlan;
      let cardSelector = '';

      if (currentPlan === 'free') {
        cardSelector = '.pricing-card:nth-child(1)'; // First card (Free)
      } else if (currentPlan === 'basic') {
        cardSelector = '.pricing-card:nth-child(2)'; // Second card (Basic)
      } else if (currentPlan === 'premium') {
        cardSelector = '.pricing-card:nth-child(3)'; // Third card (Premium)
      }

      if (cardSelector) {
        const currentCard = document.querySelector(cardSelector);
        if (currentCard) {
          currentCard.classList.add('current-plan');

          // Add current plan badge
          const badge = document.createElement('div');
          badge.className = 'current-plan-badge';

          // Check subscription status for badge text
          if (subscription.subscription_status === 'canceling' || subscription.cancel_at_period_end) {
            badge.textContent = 'Canceling at Period End';
            badge.style.background = 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)';
          } else {
            badge.textContent = 'Current Plan';
          }

          currentCard.style.position = 'relative';
          currentCard.appendChild(badge);

          // Add remaining time display for paid plans
          if (currentPlan !== 'free') {
            // Prefer Stripe data if available, otherwise use Airtable data
            const endDateString = subscription.current_period_end || subscription.plan_end_date;

            if (endDateString) {
              const timeDiv = document.createElement('div');
              timeDiv.className = 'time-remaining';
              timeDiv.style.cssText = 'margin: 32px auto 0; max-width: 600px; padding: 20px 24px; background: rgba(213, 166, 117, 0.1); border: 1px solid rgba(213, 166, 117, 0.2); border-radius: 16px; font-size: 15px; color: #fff; text-align: center; backdrop-filter: blur(10px);';

              const endDate = new Date(endDateString);
              const now = new Date();
              const daysRemaining = Math.ceil((endDate - now) / (1000 * 60 * 60 * 24));

              if (subscription.subscription_status === 'canceling' || subscription.cancel_at_period_end) {
                timeDiv.innerHTML = `<div style="font-weight: 600; margin-bottom: 4px;">Benefits active until ${endDate.toLocaleDateString()}</div><div style="font-size: 12px; opacity: 0.7;">Your subscription will end on this date and you'll be moved to the Free plan</div>`;
              } else {
                timeDiv.innerHTML = `<div style="font-weight: 600; margin-bottom: 4px;">Next billing: ${endDate.toLocaleDateString()}</div><div style="font-size: 12px; opacity: 0.7;">${daysRemaining} ${daysRemaining === 1 ? 'day' : 'days'} remaining in current period</div>`;
              }

              // Insert after the pricing grid instead of inside the card
              const pricingGrid = document.querySelector('.pricing-grid');
              if (pricingGrid) {
                pricingGrid.insertAdjacentElement('afterend', timeDiv);
              }
            }
          }

          // Update button text for current plan
          const button = currentCard.querySelector('.plan-button');
          if (button) {
            if (currentPlan === 'free') {
              button.textContent = 'Current Plan';
              button.style.opacity = '0.7';
              button.onclick = function() { return false; };
            } else if (subscription.subscription_status === 'canceling' || subscription.cancel_at_period_end) {
              button.textContent = 'Reactivate Subscription';
              button.onclick = function() {
                reactivateSubscription();
                return false;
              };
            } else {
              button.textContent = 'Manage Plan';
              button.onclick = function() {
                window.location.href = '/profile';
                return false;
              };
            }
          }
        }
      }

      // Update other plan buttons for upgrades/downgrades
      updatePlanButtons(currentPlan, subscription);
    }

    // Update plan button texts based on current subscription
    function updatePlanButtons(currentPlan, subscription) {
      const cards = document.querySelectorAll('.pricing-card');

      cards.forEach((card, index) => {
        const button = card.querySelector('.plan-button');
        if (!button || card.classList.contains('current-plan')) return;

        // Reset button onclick to default plan selection
        button.onclick = function() {
          const planTypes = ['free', 'basic', 'premium'];
          handlePlanClick(planTypes[index]);
          return false;
        };

        if (index === 0) { // Free
          if (currentPlan !== 'free') {
            button.textContent = 'Downgrade to Free';
          } else {
            button.textContent = 'Start Free';
          }
        } else if (index === 1) { // Basic
          if (currentPlan === 'free') {
            button.textContent = 'Upgrade to Basic';
          } else if (currentPlan === 'premium') {
            button.textContent = 'Downgrade to Basic';
          } else {
            button.textContent = 'Choose Basic';
          }
        } else if (index === 2) { // Premium
          if (currentPlan === 'free' || currentPlan === 'basic') {
            button.textContent = 'Upgrade to Premium';
          } else {
            button.textContent = 'Choose Premium';
          }
        }
      });
    }

    // Reactivate subscription
    async function reactivateSubscription() {
      try {
        const user = window.getCurrentUser();
        if (!user) {
          alert('Please log in to manage your subscription');
          return;
        }

        console.log('🔄 Reactivating subscription for user:', user.email);

        const response = await fetch('/.netlify/functions/selira-manage-subscription', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            action: 'reactivate',
            userEmail: user.email,
            auth0Id: user.sub
          })
        });

        const result = await response.json();

        if (response.ok && result.success) {
          console.log('✅ Subscription reactivated successfully:', result);
          alert('Subscription reactivated successfully! Your plan will continue as normal.');

          // Reload the current plan display
          await loadCurrentPlan();
        } else {
          console.error('❌ Reactivation failed:', result);
          alert(`Failed to reactivate subscription: ${result.error || 'Unknown error'}`);
        }

      } catch (error) {
        console.error('❌ Error reactivating subscription:', error);
        alert('An error occurred while reactivating your subscription. Please try again.');
      }
    }

    // Initialize current plan loading when page loads
    document.addEventListener('DOMContentLoaded', function() {
      setTimeout(loadCurrentPlan, 1000);
    });
  </script>
</body>
</html>