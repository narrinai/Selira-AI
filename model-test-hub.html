<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>AI Video Generation Test Hub - Selira AI</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        h1 {
            color: #333;
            margin-bottom: 30px;
            text-align: center;
        }

        .form-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #555;
            font-size: 14px;
        }

        input[type="text"],
        input[type="number"],
        select,
        textarea {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        .slider-group {
            display: flex;
            flex-direction: column;
        }

        input[type="range"] {
            width: 100%;
            margin: 10px 0;
        }

        .slider-value {
            text-align: center;
            font-weight: 600;
            color: #667eea;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .result-section {
            margin-top: 30px;
            padding-top: 30px;
            border-top: 2px solid #e0e0e0;
        }

        .result-section h2 {
            color: #333;
            margin-bottom: 20px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
            font-size: 18px;
            font-weight: 600;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .result-image {
            max-width: 100%;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .error {
            background: #fee;
            color: #c00;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .success {
            background: #efe;
            color: #060;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .info {
            background: #e3f2fd;
            color: #1565c0;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé¨ AI Video Generation Test Hub</h1>
        <p style="text-align: center; color: #666; margin-bottom: 20px;">Test and compare different AI video generation models & providers</p>

        <div class="info">
            <strong>Test Hub:</strong> Compare image generation (Promptchan) and video generation (Hunyuan I2V, Hunyuan T2V, RunPod) all in one place.
        </div>

        <!-- Pricing Comparison Table -->
        <div style="background: #f5f5f5; padding: 20px; border-radius: 10px; margin-bottom: 30px;">
            <h3 style="margin-bottom: 15px; color: #333;">üí∞ Cost Comparison</h3>
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background: #667eea; color: white;">
                        <th style="padding: 10px; text-align: left;">Provider</th>
                        <th style="padding: 10px; text-align: left;">Type</th>
                        <th style="padding: 10px; text-align: right;">Per Video</th>
                        <th style="padding: 10px; text-align: right;">Per 100</th>
                        <th style="padding: 10px; text-align: center;">NSFW</th>
                    </tr>
                </thead>
                <tbody>
                    <tr style="background: #e8f5e9;">
                        <td style="padding: 10px;"><strong>RunPod</strong></td>
                        <td style="padding: 10px;">Image-to-Video</td>
                        <td style="padding: 10px; text-align: right;"><strong>$0.02</strong> üèÜ</td>
                        <td style="padding: 10px; text-align: right;">$2</td>
                        <td style="padding: 10px; text-align: center;">‚úÖ</td>
                    </tr>
                    <tr>
                        <td style="padding: 10px;">Fal.ai (Hunyuan I2V)</td>
                        <td style="padding: 10px;">Image-to-Video</td>
                        <td style="padding: 10px; text-align: right;">$0.40</td>
                        <td style="padding: 10px; text-align: right;">$40</td>
                        <td style="padding: 10px; text-align: center;">‚ö†Ô∏è ToS risk</td>
                    </tr>
                    <tr>
                        <td style="padding: 10px;">Replicate (Hunyuan T2V)</td>
                        <td style="padding: 10px;">Text-to-Video</td>
                        <td style="padding: 10px; text-align: right;">~$1.25</td>
                        <td style="padding: 10px; text-align: right;">$125</td>
                        <td style="padding: 10px; text-align: center;">‚ö†Ô∏è ToS risk</td>
                    </tr>
                    <tr style="background: #ffebee;">
                        <td style="padding: 10px;">Promptchan</td>
                        <td style="padding: 10px;">Text-to-Video</td>
                        <td style="padding: 10px; text-align: right;">$3.23</td>
                        <td style="padding: 10px; text-align: right;">$323</td>
                        <td style="padding: 10px; text-align: center;">‚úÖ</td>
                    </tr>
                    <tr>
                        <td style="padding: 10px;">Promptchan</td>
                        <td style="padding: 10px;">Image Gen</td>
                        <td style="padding: 10px; text-align: right;">$0.01</td>
                        <td style="padding: 10px; text-align: right;">$1</td>
                        <td style="padding: 10px; text-align: center;">‚úÖ</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Tab Navigation -->
        <div style="display: flex; gap: 10px; margin-bottom: 30px; border-bottom: 2px solid #e0e0e0; flex-wrap: wrap;">
            <button type="button" onclick="switchTab('image')" id="imageTab" style="flex: 1; min-width: 150px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 10px 10px 0 0; padding: 12px;">
                üñºÔ∏è Image Gen<br><small style="font-size: 11px;">Promptchan</small>
            </button>
            <button type="button" onclick="switchTab('video-i2v-fal')" id="videoI2vFalTab" style="flex: 1; min-width: 150px; background: #e0e0e0; color: #333; border-radius: 10px 10px 0 0; padding: 12px;">
                üé¨ I2V Fal.ai<br><small style="font-size: 11px;">Hunyuan $0.40</small>
            </button>
            <button type="button" onclick="switchTab('video-t2v-replicate')" id="videoT2vReplicateTab" style="flex: 1; min-width: 150px; background: #e0e0e0; color: #333; border-radius: 10px 10px 0 0; padding: 12px;">
                üé• T2V Replicate<br><small style="font-size: 11px;">Hunyuan $1.25</small>
            </button>
            <button type="button" onclick="switchTab('video-i2v-runpod')" id="videoI2vRunpodTab" style="flex: 1; min-width: 150px; background: #e0e0e0; color: #333; border-radius: 10px 10px 0 0; padding: 12px;">
                üöÄ I2V RunPod<br><small style="font-size: 11px;">AnimateDiff $0.02</small>
            </button>
            <button type="button" onclick="switchTab('video-t2v-traits')" id="videoT2vTraitsTab" style="flex: 1; min-width: 150px; background: #e0e0e0; color: #333; border-radius: 10px 10px 0 0; padding: 12px;">
                üë§ T2V Traits<br><small style="font-size: 11px;">RunPod + Traits</small>
            </button>
        </div>

        <!-- FAL.AI HUNYUAN I2V SECTION -->
        <div id="videoI2vFalSection" style="display: none;">
            <h2 style="margin-bottom: 20px;">üé¨ Fal.ai - Hunyuan Image-to-Video ($0.40/video)</h2>
            <form id="videoI2vFalForm">
                <div class="form-section">
                    <div class="form-group full-width">
                        <label for="video_image_url">Image URL *</label>
                        <input type="text" id="video_image_url" name="video_image_url" required placeholder="https://example.com/image.jpg">
                        <small style="color: #666; margin-top: 5px; display: block;">Direct URL to the image you want to animate</small>
                    </div>

                    <div class="form-group full-width">
                        <label for="video_prompt">Video Prompt *</label>
                        <textarea id="video_prompt" name="video_prompt" required placeholder="A cat walks on the grass, realistic style"></textarea>
                        <small style="color: #666; margin-top: 5px; display: block;">Describe the motion/animation you want</small>
                    </div>

                    <div class="form-group">
                        <label for="video_model">Model</label>
                        <select id="video_model" name="video_model">
                            <option value="hunyuan-video">Hunyuan Video (Image-to-Video)</option>
                            <option value="stable-video-diffusion">Stable Video Diffusion</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="video_resolution">Resolution</label>
                        <select id="video_resolution" name="video_resolution">
                            <option value="540p">540p (960x540)</option>
                            <option value="720p" selected>720p (1280x720)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="aspect_ratio">Aspect Ratio</label>
                        <select id="aspect_ratio" name="aspect_ratio">
                            <option value="16:9" selected>16:9 (Landscape)</option>
                            <option value="9:16">9:16 (Portrait)</option>
                            <option value="1:1">1:1 (Square)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="video_fps">Frames Per Second</label>
                        <select id="video_fps" name="video_fps">
                            <option value="15">15 FPS</option>
                            <option value="24" selected>24 FPS</option>
                            <option value="30">30 FPS</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="num_frames">Number of Frames</label>
                        <select id="num_frames" name="num_frames">
                            <option value="49">49 frames (~2 sec)</option>
                            <option value="65">65 frames (~2.7 sec)</option>
                            <option value="97">97 frames (~4 sec)</option>
                            <option value="129" selected>129 frames (~5.4 sec)</option>
                            <option value="161">161 frames (~6.7 sec)</option>
                        </select>
                        <small style="color: #666; margin-top: 5px; display: block;">Must be 4k+1 (e.g., 49, 129)</small>
                    </div>

                    <div class="form-group slider-group">
                        <label for="infer_steps">Inference Steps (20-100): <span class="slider-value" id="inferStepsValue">50</span></label>
                        <input type="range" id="infer_steps" name="infer_steps" min="20" max="100" value="50">
                        <small style="color: #666; margin-top: 5px; display: block;">Higher = better quality but slower</small>
                    </div>

                    <div class="form-group slider-group">
                        <label for="guidance_scale">Guidance Scale (1-10): <span class="slider-value" id="guidanceValue">6</span></label>
                        <input type="range" id="guidance_scale" name="guidance_scale" min="1" max="10" step="0.5" value="6">
                        <small style="color: #666; margin-top: 5px; display: block;">How closely to follow the prompt</small>
                    </div>

                    <div class="form-group">
                        <label for="video_seed">Seed (-1 for random)</label>
                        <input type="number" id="video_seed" name="video_seed" value="-1">
                    </div>

                    <div class="form-group checkbox-group">
                        <input type="checkbox" id="i2v_stability" name="i2v_stability" checked>
                        <label for="i2v_stability">I2V Stability (reduces hallucination)</label>
                    </div>
                </div>

                <button type="submit" id="videoI2vFalGenerateBtn">Generate Video with Fal.ai ($0.40)</button>
            </form>
        </div>

        <!-- REPLICATE HUNYUAN T2V SECTION -->
        <div id="videoT2vReplicateSection" style="display: none;">
            <h2 style="margin-bottom: 20px;">üé• Replicate - Hunyuan Text-to-Video (~$1.25/video)</h2>
            <div class="info" style="margin-bottom: 20px;">
                <strong>Note:</strong> Text-to-video only (no image input). More expensive but generates from scratch.
            </div>
            <form id="videoT2vReplicateForm">
                <div class="form-section">
                    <div class="form-group full-width">
                        <label for="t2v_prompt">Video Prompt *</label>
                        <textarea id="t2v_prompt" name="t2v_prompt" required placeholder="A cat walks on the grass, realistic style"></textarea>
                        <small style="color: #666; margin-top: 5px; display: block;">Describe the entire video scene and action</small>
                    </div>

                    <div class="form-group">
                        <label for="t2v_width">Width</label>
                        <select id="t2v_width" name="t2v_width">
                            <option value="544">544px</option>
                            <option value="720">720px</option>
                            <option value="864" selected>864px</option>
                            <option value="1088">1088px</option>
                            <option value="1280">1280px</option>
                        </select>
                        <small>Must be divisible by 16</small>
                    </div>

                    <div class="form-group">
                        <label for="t2v_height">Height</label>
                        <select id="t2v_height" name="t2v_height">
                            <option value="304">304px</option>
                            <option value="480" selected>480px</option>
                            <option value="544">544px</option>
                            <option value="720">720px</option>
                        </select>
                        <small>Must be divisible by 16</small>
                    </div>

                    <div class="form-group">
                        <label for="t2v_video_length">Video Length (frames)</label>
                        <select id="t2v_video_length" name="t2v_video_length">
                            <option value="49">49 frames (~2s)</option>
                            <option value="65">65 frames (~2.7s)</option>
                            <option value="97">97 frames (~4s)</option>
                            <option value="129" selected>129 frames (~5.4s)</option>
                            <option value="161">161 frames (~6.7s)</option>
                        </select>
                        <small>Must be 4k+1 (e.g., 49, 129)</small>
                    </div>

                    <div class="form-group">
                        <label for="t2v_fps">FPS</label>
                        <select id="t2v_fps" name="t2v_fps">
                            <option value="15">15 FPS</option>
                            <option value="24" selected>24 FPS</option>
                            <option value="30">30 FPS</option>
                        </select>
                    </div>

                    <div class="form-group slider-group">
                        <label for="t2v_infer_steps">Inference Steps (20-100): <span class="slider-value" id="t2vInferStepsValue">50</span></label>
                        <input type="range" id="t2v_infer_steps" name="t2v_infer_steps" min="20" max="100" value="50">
                        <small style="color: #666; margin-top: 5px; display: block;">Higher = better quality but slower</small>
                    </div>

                    <div class="form-group slider-group">
                        <label for="t2v_guidance_scale">Guidance Scale (1-10): <span class="slider-value" id="t2vGuidanceValue">6</span></label>
                        <input type="range" id="t2v_guidance_scale" name="t2v_guidance_scale" min="1" max="10" step="0.5" value="6">
                        <small style="color: #666; margin-top: 5px; display: block;">How closely to follow the prompt</small>
                    </div>

                    <div class="form-group">
                        <label for="t2v_seed">Seed (-1 for random)</label>
                        <input type="number" id="t2v_seed" name="t2v_seed" value="-1">
                    </div>
                </div>

                <button type="submit" id="videoT2vReplicateGenerateBtn">Generate Video with Replicate (~$1.25)</button>
            </form>
        </div>

        <!-- RUNPOD I2V SECTION -->
        <div id="videoI2vRunpodSection" style="display: none;">
            <h2 style="margin-bottom: 20px;">üöÄ RunPod - Wan2.2 Image-to-Video (~$0.02/video)</h2>
            <div class="info" style="margin-bottom: 20px;">
                <strong>Cheapest Option!</strong> Wan2.2 model - supports NSFW content. Default: 10 steps, CFG 2.0, 81 frames.
            </div>
            <form id="videoI2vRunpodForm">
                <div class="form-section">
                    <div class="form-group full-width">
                        <label for="runpod_image_url">Image URL *</label>
                        <input type="text" id="runpod_image_url" name="runpod_image_url" required placeholder="https://example.com/image.jpg">
                        <small>Direct URL to the image you want to animate</small>
                    </div>

                    <div class="form-group full-width">
                        <label for="runpod_prompt">Motion Prompt *</label>
                        <textarea id="runpod_prompt" name="runpod_prompt" required placeholder="The woman slowly turns her head to the left, smiling"></textarea>
                        <small>Describe the movement/animation</small>
                    </div>

                    <div class="form-group full-width">
                        <label for="runpod_negative_prompt">Negative Prompt</label>
                        <textarea id="runpod_negative_prompt" name="runpod_negative_prompt" placeholder="static, no motion, frozen, blurry, low quality"></textarea>
                        <small>What to avoid in the video</small>
                    </div>

                    <div class="form-group">
                        <label for="runpod_model">Model</label>
                        <select id="runpod_model" name="runpod_model">
                            <option value="animatediff">AnimateDiff v3 (general motion)</option>
                            <option value="animatediff-lightning">AnimateDiff Lightning (faster)</option>
                            <option value="svd" selected>Stable Video Diffusion (better faces)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="runpod_num_frames">Video Length (Frames)</label>
                        <select id="runpod_num_frames" name="runpod_num_frames">
                            <option value="49">49 frames</option>
                            <option value="81" selected>81 frames (recommended)</option>
                            <option value="120">120 frames (longer)</option>
                        </select>
                        <small>More frames = longer video but slower generation</small>
                    </div>

                    <div class="form-group">
                        <label for="runpod_resolution">Resolution</label>
                        <select id="runpod_resolution" name="runpod_resolution">
                            <option value="480x832" selected>480x832 (Portrait - recommended)</option>
                            <option value="832x480">832x480 (Landscape)</option>
                            <option value="512x512">512x512 (Square)</option>
                            <option value="720x480">720x480 (Standard)</option>
                        </select>
                    </div>

                    <div class="form-group slider-group">
                        <label for="runpod_guidance_scale">CFG Scale (1-10): <span class="slider-value" id="runpodGuidanceValue">5.5</span></label>
                        <input type="range" id="runpod_guidance_scale" name="runpod_guidance_scale" min="1" max="10" step="0.5" value="5.5">
                        <small>Higher = better object consistency & less artifacts. Use 5-7 for complex scenes.</small>
                    </div>

                    <div class="form-group slider-group">
                        <label for="runpod_motion_intensity">Motion Intensity (0-255): <span class="slider-value" id="runpodMotionValue">190</span></label>
                        <input type="range" id="runpod_motion_intensity" name="runpod_motion_intensity" min="0" max="255" step="1" value="190">
                        <small>SVD only. Higher = stronger movement. 190-220 for blowjob/deepthroat motion.</small>
                    </div>

                    <div class="form-group">
                        <label for="runpod_steps">Inference Steps</label>
                        <select id="runpod_steps" name="runpod_steps">
                            <option value="10">10 steps (fast, lower quality)</option>
                            <option value="20">20 steps (recommended)</option>
                            <option value="30" selected>30 steps (best quality, reduces artifacts)</option>
                            <option value="50">50 steps (highest quality, slowest)</option>
                        </select>
                        <small>‚ö†Ô∏è Higher steps = less artifacts/glitches. Use 30+ for clean results.</small>
                    </div>

                    <div class="form-group">
                        <label for="runpod_fps">Frames Per Second (FPS)</label>
                        <select id="runpod_fps" name="runpod_fps">
                            <option value="24">24 fps (cinematic)</option>
                            <option value="25" selected>25 fps (recommended)</option>
                            <option value="30">30 fps (smooth)</option>
                        </select>
                        <small>Higher FPS = smoother motion</small>
                    </div>

                    <div class="form-group">
                        <label for="runpod_seed">Seed (-1 for random)</label>
                        <input type="number" id="runpod_seed" name="runpod_seed" value="-1">
                    </div>
                </div>

                <button type="submit" id="videoI2vRunpodGenerateBtn">Generate Video with RunPod (~$0.02)</button>
            </form>
        </div>

        <!-- TEXT-TO-VIDEO WITH TRAITS SECTION -->
        <div id="videoT2vTraitsSection" style="display: none;">
            <h2 style="margin-bottom: 20px;">üë§ Video Generation from Companion Traits</h2>
            <div class="info" style="margin-bottom: 20px;">
                <strong>Choose your provider:</strong><br>
                ‚Ä¢ <strong>RunPod (~$0.03):</strong> 2-step process (image‚Üívideo). Cheapest but NOT true T2V.<br>
                ‚Ä¢ <strong>Fal.ai (~$0.50):</strong> True text-to-video with Kling AI.<br>
                ‚Ä¢ <strong>Replicate (~$1.25):</strong> True text-to-video with Hunyuan (highest quality).
            </div>
            <form id="videoT2vTraitsForm">
                <div class="form-section">
                    <!-- Companion Traits -->
                    <div class="form-group full-width" style="background: #f0f8ff; padding: 15px; border-radius: 8px;">
                        <h3 style="margin-bottom: 15px; color: #333;">üë§ Companion Traits</h3>

                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 15px;">
                            <div class="form-group">
                                <label for="traits_name">Name (optional)</label>
                                <input type="text" id="traits_name" name="traits_name" placeholder="e.g., Laura">
                            </div>

                            <div class="form-group">
                                <label for="traits_age">Age</label>
                                <input type="number" id="traits_age" name="traits_age" value="25" min="18" max="60">
                            </div>

                            <div class="form-group">
                                <label for="traits_ethnicity">Ethnicity</label>
                                <select id="traits_ethnicity" name="traits_ethnicity">
                                    <option value="caucasian" selected>Caucasian</option>
                                    <option value="asian">Asian</option>
                                    <option value="black">Black</option>
                                    <option value="latina">Latina</option>
                                    <option value="middle-eastern">Middle Eastern</option>
                                    <option value="indian">Indian</option>
                                    <option value="mixed">Mixed</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="traits_body_type">Body Type</label>
                                <select id="traits_body_type" name="traits_body_type">
                                    <option value="slim">Slim</option>
                                    <option value="athletic" selected>Athletic</option>
                                    <option value="curvy">Curvy</option>
                                    <option value="petite">Petite</option>
                                    <option value="average">Average</option>
                                    <option value="plus-size">Plus Size</option>
                                </select>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div class="form-group">
                                <label for="traits_hair_color">Hair Color</label>
                                <select id="traits_hair_color" name="traits_hair_color">
                                    <option value="black">Black</option>
                                    <option value="brown" selected>Brown</option>
                                    <option value="blonde">Blonde</option>
                                    <option value="red">Red</option>
                                    <option value="gray">Gray</option>
                                    <option value="white">White</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="traits_hair_length">Hair Length</label>
                                <select id="traits_hair_length" name="traits_hair_length">
                                    <option value="short">Short</option>
                                    <option value="medium">Medium</option>
                                    <option value="long" selected>Long</option>
                                    <option value="very long">Very Long</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Action & Setting -->
                    <div class="form-group full-width">
                        <label for="traits_action">Action/Motion *</label>
                        <textarea id="traits_action" name="traits_action" required rows="4" placeholder="e.g., POV from above. Her mouth around large rigid erect penis shaft. Extreme vertical head bobbing, her head moves down engulfing the hard cock shaft deeply then back up to tip repeatedly. Fast pronounced deepthroat pumping motion along the stiff penis. The erect shaft stays rigid and visible throughout.">Smiling at camera, gentle head movement</textarea>
                        <small><strong>Tip for object consistency:</strong> Repeat object description (e.g., "erect penis shaft", "hard cock", "rigid shaft") multiple times in prompt. Be specific: "her mouth around the shaft", "head moves along the penis". This prevents morphing.</small>
                    </div>

                    <div class="form-group full-width">
                        <label for="traits_setting">Setting/Background *</label>
                        <input type="text" id="traits_setting" name="traits_setting" required value="Indoor lighting, soft background" placeholder="e.g., outdoor park, beach sunset, bedroom">
                        <small>Describe the environment/location</small>
                    </div>

                    <!-- Style Selection -->
                    <div class="form-group">
                        <label for="traits_style">Art Style</label>
                        <select id="traits_style" name="traits_style">
                            <option value="realistic" selected>Realistic / Photorealistic</option>
                            <option value="anime">Anime / Hentai Style</option>
                        </select>
                        <small>üí° Anime style may handle movement and objects better due to stylized nature</small>
                    </div>

                    <!-- Provider Selection -->
                    <div class="form-group">
                        <label for="traits_provider">Video Provider</label>
                        <select id="traits_provider" name="traits_provider">
                            <option value="runpod" selected>RunPod (~$0.03) - Image‚ÜíVideo 2-step</option>
                            <option value="fal">Fal.ai Kling (~$0.50) - True Text‚ÜíVideo</option>
                            <option value="replicate">Replicate Hunyuan (~$1.25) - True Text‚ÜíVideo</option>
                        </select>
                        <small>‚ö†Ô∏è RunPod is NOT true T2V (generates image first, then animates). Fal.ai/Replicate are true T2V but more expensive.</small>
                    </div>

                    <!-- Advanced Settings -->
                    <div class="form-group">
                        <label for="traits_duration">Video Duration</label>
                        <select id="traits_duration" name="traits_duration">
                            <option value="5" selected>5 seconds</option>
                            <option value="10">10 seconds</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="traits_aspect_ratio">Aspect Ratio</label>
                        <select id="traits_aspect_ratio" name="traits_aspect_ratio">
                            <option value="1:1">1:1 (Square)</option>
                            <option value="16:9" selected>16:9 (Landscape)</option>
                            <option value="9:16">9:16 (Portrait)</option>
                        </select>
                    </div>

                    <div class="form-group full-width">
                        <label for="traits_negative_prompt">Negative Prompt (optional)</label>
                        <input type="text" id="traits_negative_prompt" name="traits_negative_prompt" value="low quality, blurry, distorted, deformed, morphing, transformation, object changing, inconsistent objects, tongue instead of penis, shape-shifting" placeholder="Things to avoid">
                        <small><strong>Anti-morphing tip:</strong> Include "morphing, transformation, object changing, inconsistent" to reduce penis‚Üítongue transformations</small>
                    </div>

                    <!-- Advanced Motion Controls (Replicate/Hunyuan) -->
                    <div class="form-group full-width" style="background: #fff3e0; padding: 15px; border-radius: 8px; margin-top: 15px;">
                        <h3 style="margin-bottom: 15px; color: #333;">‚öôÔ∏è Advanced Motion Controls (Replicate only)</h3>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div class="form-group">
                                <label for="traits_video_length">Video Length (Frames)</label>
                                <select id="traits_video_length" name="traits_video_length">
                                    <option value="65">65 frames (~2.7s @ 24fps)</option>
                                    <option value="97">97 frames (~4s @ 24fps)</option>
                                    <option value="129" selected>129 frames (~5.4s @ 24fps, recommended)</option>
                                    <option value="161">161 frames (~6.7s @ 24fps)</option>
                                    <option value="193">193 frames (~8s @ 24fps, more motion time)</option>
                                </select>
                                <small>More frames = longer video = more time for movement</small>
                            </div>

                            <div class="form-group">
                                <label for="traits_infer_steps">Inference Steps</label>
                                <select id="traits_infer_steps" name="traits_infer_steps">
                                    <option value="30">30 steps (faster, lower quality)</option>
                                    <option value="40">40 steps (balanced)</option>
                                    <option value="50" selected>50 steps (recommended)</option>
                                    <option value="60">60 steps (slower, higher quality)</option>
                                </select>
                                <small>Higher = better quality but slower</small>
                            </div>

                            <div class="form-group">
                                <label for="traits_fps">FPS (Frames Per Second)</label>
                                <select id="traits_fps" name="traits_fps">
                                    <option value="20">20 fps (slower motion)</option>
                                    <option value="24" selected>24 fps (cinematic, recommended)</option>
                                    <option value="30">30 fps (faster motion)</option>
                                </select>
                                <small>Higher FPS = action appears faster</small>
                            </div>
                        </div>

                        <div class="form-group slider-group" style="margin-top: 10px;">
                            <label for="traits_guidance_scale">Guidance Scale (1-15): <span class="slider-value" id="traitsGuidanceValue">6</span></label>
                            <input type="range" id="traits_guidance_scale" name="traits_guidance_scale" min="1" max="15" step="0.5" value="6">
                            <small>Lower (4-5) = more creative/movement freedom. Higher (7-10) = stricter prompt following. Default: 6</small>
                        </div>
                    </div>
                </div>

                <button type="submit" id="videoT2vTraitsGenerateBtn">Generate Video from Traits</button>
            </form>
        </div>

        <!-- IMAGE GENERATION SECTION -->
        <div id="imageSection">
            <!-- Quick Test Buttons for Companion Traits -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 30px; padding: 20px; background: #f5f5f5; border-radius: 10px;">
                <div>
                    <h3 style="margin-bottom: 10px; color: #333;">üßî Test Male Companion</h3>
                    <button type="button" onclick="testMaleCompanion()" style="background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);">
                        Test: Indian Male, Red Hair, Short
                    </button>
                </div>
                <div>
                    <h3 style="margin-bottom: 10px; color: #333;">üë© Test Female Companion</h3>
                    <button type="button" onclick="testFemaleCompanion()" style="background: linear-gradient(135deg, #E91E63 0%, #C2185B 100%);">
                        Test: Black Female, Blonde Hair, Long
                    </button>
                </div>
            </div>

            <form id="generateForm">
            <div class="form-section">
                <!-- Companion Traits Section -->
                <div class="form-group full-width" style="background: #f0f8ff; padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                    <h3 style="margin-bottom: 15px; color: #333;">üë§ Companion Traits (Optional - Auto-builds appearance)</h3>

                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px;">
                        <div class="form-group">
                            <label for="companion_sex">Sex</label>
                            <select id="companion_sex" name="companion_sex">
                                <option value="">-- None --</option>
                                <option value="female">Female</option>
                                <option value="male">Male</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="companion_ethnicity">Ethnicity</label>
                            <select id="companion_ethnicity" name="companion_ethnicity">
                                <option value="">-- None --</option>
                                <option value="white">White/Caucasian</option>
                                <option value="black">Black/African American</option>
                                <option value="asian">Asian (East Asian)</option>
                                <option value="indian">Indian (South Asian)</option>
                                <option value="latina">Latina/Hispanic</option>
                                <option value="middle-eastern">Middle Eastern</option>
                                <option value="mixed">Mixed</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="companion_hair_color">Hair Color</label>
                            <select id="companion_hair_color" name="companion_hair_color">
                                <option value="">-- None --</option>
                                <option value="black">Black</option>
                                <option value="brown">Brown</option>
                                <option value="blonde">Blonde</option>
                                <option value="red">Red/Ginger</option>
                                <option value="auburn">Auburn</option>
                                <option value="gray">Gray/Silver</option>
                                <option value="white">White/Platinum</option>
                                <option value="purple">Purple</option>
                                <option value="pink">Pink</option>
                                <option value="blue">Blue</option>
                                <option value="green">Green</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="companion_hair_length">Hair Length</label>
                            <select id="companion_hair_length" name="companion_hair_length">
                                <option value="">-- None --</option>
                                <option value="bald">Bald</option>
                                <option value="short">Short</option>
                                <option value="medium">Medium</option>
                                <option value="long">Long</option>
                            </select>
                        </div>
                    </div>

                    <div class="checkbox-group" style="margin-top: 15px;">
                        <input type="checkbox" id="use_companion_traits" name="use_companion_traits">
                        <label for="use_companion_traits">
                            <strong>Auto-build appearance from traits above</strong>
                            <span style="color: #666; font-size: 12px;">(will prepend to prompt)</span>
                        </label>
                    </div>
                </div>

                <div class="form-group full-width">
                    <label for="prompt">Prompt *</label>
                    <textarea id="prompt" name="prompt" required placeholder="Describe the image you want to generate..."></textarea>
                </div>

                <div class="form-group full-width">
                    <label for="negative_prompt">Negative Prompt</label>
                    <textarea id="negative_prompt" name="negative_prompt" placeholder="What to avoid in the image..."></textarea>
                </div>

                <div class="form-group">
                    <label for="style">Style</label>
                    <select id="style" name="style">
                        <option value="Cinematic">Cinematic</option>
                        <option value="Anime">Anime</option>
                        <option value="Hyperreal">Hyperreal</option>
                        <option value="Hyperanime">Hyperanime</option>
                        <option value="K-Pop">K-Pop</option>
                        <option value="Render XL+">Render XL+</option>
                        <option value="Illustration XL+">Illustration XL+</option>
                        <option value="Anime XL">Anime XL</option>
                        <option value="Anime XL+">Anime XL+</option>
                        <option value="Photo XL+">Photo XL+</option>
                        <option value="Hyperreal XL+">Hyperreal XL+</option>
                        <option value="Hyperreal XL+ v2">Hyperreal XL+ v2</option>
                        <option value="Photo XL+ v2">Photo XL+ v2</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="filter">Filter</label>
                    <select id="filter" name="filter">
                        <option value="Default">Default</option>
                        <option value="Cinematic">Cinematic</option>
                        <option value="Studio">Studio</option>
                        <option value="Flash">Flash</option>
                        <option value="Analog">Analog</option>
                        <option value="Professional">Professional</option>
                        <option value="Vintage">Vintage</option>
                        <option value="Manga">Manga</option>
                        <option value="Cyberpunk">Cyberpunk</option>
                        <option value="Anime Studio">Anime Studio</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="quality">Quality</label>
                    <select id="quality" name="quality">
                        <option value="Ultra">Ultra (1 Gem)</option>
                        <option value="Extreme">Extreme (+1 Gem)</option>
                        <option value="Max">Max (+2 Gems)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="image_size">Image Size</label>
                    <select id="image_size" name="image_size">
                        <option value="256x256">Tiny (256x256) - FASTEST</option>
                        <option value="512x512">Square (512x512)</option>
                        <option value="512x768">Portrait (512x768)</option>
                        <option value="768x512">Landscape (768x512)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="emotion">Emotion</label>
                    <select id="emotion" name="emotion">
                        <option value="Default">Default</option>
                        <option value="Smiling">Smiling</option>
                        <option value="Laughing">Laughing</option>
                        <option value="Winking">Winking</option>
                        <option value="Shocked">Shocked</option>
                        <option value="Angry">Angry</option>
                        <option value="Scared">Scared</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="creativity">Creativity (5-70)</label>
                    <input type="number" id="creativity" name="creativity" value="5" min="5" max="70" step="5">
                </div>

                <div class="form-group slider-group">
                    <label for="detail">Detail Level (-2 to 2): <span class="slider-value" id="detailValue">0</span></label>
                    <input type="range" id="detail" name="detail" min="-2" max="2" step="0.1" value="0">
                </div>

                <div class="form-group slider-group">
                    <label for="age_slider">Age (18+): <span class="slider-value" id="ageValue">25</span></label>
                    <input type="range" id="age_slider" name="age_slider" min="18" max="80" value="25">
                </div>

                <div class="form-group slider-group">
                    <label for="weight_slider">Weight (-1 to 1): <span class="slider-value" id="weightValue">0</span></label>
                    <input type="range" id="weight_slider" name="weight_slider" min="-1" max="1" step="0.1" value="0">
                </div>

                <div class="form-group slider-group">
                    <label for="breast_slider">Breast Size (-1 to 1): <span class="slider-value" id="breastValue">0</span></label>
                    <input type="range" id="breast_slider" name="breast_slider" min="-1" max="1" step="0.1" value="0">
                </div>

                <div class="form-group slider-group">
                    <label for="ass_slider">Ass Size (-1 to 1): <span class="slider-value" id="assValue">0</span></label>
                    <input type="range" id="ass_slider" name="ass_slider" min="-1" max="1" step="0.1" value="0">
                </div>

                <div class="form-group">
                    <label for="seed">Seed (-1 for random)</label>
                    <input type="number" id="seed" name="seed" value="-1">
                </div>

                <div class="form-group checkbox-group">
                    <input type="checkbox" id="restore_faces" name="restore_faces">
                    <label for="restore_faces">Restore Faces (+1 Gem, realistic styles only)</label>
                </div>
            </div>

            <button type="submit" id="generateBtn">Generate Image</button>
        </form>
        </div>

        <div class="result-section" id="resultSection" style="display: none;">
            <h2>Result</h2>
            <div id="resultContent"></div>
        </div>
    </div>

    <script>
        // Tab switching
        function switchTab(tab) {
            const sections = {
                'image': document.getElementById('imageSection'),
                'video-i2v-fal': document.getElementById('videoI2vFalSection'),
                'video-t2v-replicate': document.getElementById('videoT2vReplicateSection'),
                'video-i2v-runpod': document.getElementById('videoI2vRunpodSection'),
                'video-t2v-traits': document.getElementById('videoT2vTraitsSection')
            };

            const tabs = {
                'image': document.getElementById('imageTab'),
                'video-i2v-fal': document.getElementById('videoI2vFalTab'),
                'video-t2v-replicate': document.getElementById('videoT2vReplicateTab'),
                'video-i2v-runpod': document.getElementById('videoI2vRunpodTab'),
                'video-t2v-traits': document.getElementById('videoT2vTraitsTab')
            };

            // Hide all sections and deactivate all tabs
            Object.values(sections).forEach(section => section.style.display = 'none');
            Object.values(tabs).forEach(tabBtn => {
                tabBtn.style.background = '#e0e0e0';
                tabBtn.style.color = '#333';
            });

            // Show selected section and activate tab
            sections[tab].style.display = 'block';
            tabs[tab].style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
            tabs[tab].style.color = 'white';
        }

        // Update fal.ai I2V slider values
        document.getElementById('infer_steps').addEventListener('input', (e) => {
            document.getElementById('inferStepsValue').textContent = e.target.value;
        });

        document.getElementById('guidance_scale').addEventListener('input', (e) => {
            document.getElementById('guidanceValue').textContent = e.target.value;
        });

        // Update Replicate T2V slider values
        document.getElementById('t2v_infer_steps').addEventListener('input', (e) => {
            document.getElementById('t2vInferStepsValue').textContent = e.target.value;
        });

        document.getElementById('t2v_guidance_scale').addEventListener('input', (e) => {
            document.getElementById('t2vGuidanceValue').textContent = e.target.value;
        });

        // Update RunPod slider values
        document.getElementById('runpod_guidance_scale').addEventListener('input', (e) => {
            document.getElementById('runpodGuidanceValue').textContent = e.target.value;
        });

        document.getElementById('runpod_motion_intensity').addEventListener('input', (e) => {
            document.getElementById('runpodMotionValue').textContent = e.target.value;
        });

        // Update T2V Traits slider values
        document.getElementById('traits_guidance_scale').addEventListener('input', (e) => {
            document.getElementById('traitsGuidanceValue').textContent = e.target.value;
        });

        // Handle fal.ai I2V form submission
        document.getElementById('videoI2vFalForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const generateBtn = document.getElementById('videoI2vFalGenerateBtn');
            const resultSection = document.getElementById('resultSection');
            const resultContent = document.getElementById('resultContent');

            // Disable button and show loading
            generateBtn.disabled = true;
            generateBtn.textContent = 'Generating Video...';
            resultSection.style.display = 'block';
            resultContent.innerHTML = '<div class="loading"><div class="spinner"></div>Generating your video... This may take a few minutes.</div>';

            // Collect form data
            const formData = {
                image_url: document.getElementById('video_image_url').value,
                prompt: document.getElementById('video_prompt').value,
                model: document.getElementById('video_model').value,
                resolution: document.getElementById('video_resolution').value,
                aspect_ratio: document.getElementById('aspect_ratio').value,
                fps: parseInt(document.getElementById('video_fps').value),
                num_frames: parseInt(document.getElementById('num_frames').value),
                infer_steps: parseInt(document.getElementById('infer_steps').value),
                guidance_scale: parseFloat(document.getElementById('guidance_scale').value),
                seed: parseInt(document.getElementById('video_seed').value),
                i2v_stability: document.getElementById('i2v_stability').checked
            };

            try {
                console.log('Sending video generation request with data:', formData);

                const response = await fetch('/.netlify/functions/promptchan-generate-video', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || 'Failed to generate video');
                }

                console.log('Response:', data);

                // Display success
                resultContent.innerHTML = `
                    <div class="success">
                        <strong>Success!</strong> Video generated successfully via ${data.provider || 'fal.ai'}
                        ${data.cost ? `<br>Cost: ${data.cost}` : ''}
                    </div>
                    <div style="margin-top: 20px;">
                        <h3>Settings Used:</h3>
                        <ul style="text-align: left; max-width: 600px; margin: 10px auto;">
                            <li><strong>Aspect Ratio:</strong> ${formData.aspect_ratio}</li>
                            <li><strong>Resolution:</strong> ${formData.resolution}</li>
                            <li><strong>Frames:</strong> ${formData.num_frames} (~${(formData.num_frames / formData.fps).toFixed(1)}s @ ${formData.fps} FPS)</li>
                            <li><strong>Guidance Scale:</strong> ${formData.guidance_scale}</li>
                            <li><strong>I2V Stability:</strong> ${formData.i2v_stability ? 'Enabled' : 'Disabled'}</li>
                        </ul>
                    </div>
                    <div style="margin-top: 20px; text-align: center;">
                        <video controls class="result-image" style="max-width: 100%;">
                            <source src="${data.video}" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                        <p style="margin-top: 10px;">
                            <a href="${data.video}" download style="color: #667eea; font-weight: 600;">Download Video</a>
                        </p>
                    </div>
                `;

            } catch (error) {
                console.error('Error:', error);
                resultContent.innerHTML = `
                    <div class="error">
                        <strong>Error:</strong> ${error.message}
                    </div>
                `;
            } finally {
                // Re-enable button
                generateBtn.disabled = false;
                generateBtn.textContent = 'Generate Video';
            }
        });

        // Handle Replicate T2V form submission
        document.getElementById('videoT2vReplicateForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const generateBtn = document.getElementById('videoT2vReplicateGenerateBtn');
            const resultSection = document.getElementById('resultSection');
            const resultContent = document.getElementById('resultContent');

            generateBtn.disabled = true;
            generateBtn.textContent = 'Generating Video...';
            resultSection.style.display = 'block';
            resultContent.innerHTML = '<div class="loading"><div class="spinner"></div>Generating video with Replicate... This may take 3-5 minutes.</div>';

            const formData = {
                prompt: document.getElementById('t2v_prompt').value,
                width: parseInt(document.getElementById('t2v_width').value),
                height: parseInt(document.getElementById('t2v_height').value),
                video_length: parseInt(document.getElementById('t2v_video_length').value),
                fps: parseInt(document.getElementById('t2v_fps').value),
                infer_steps: parseInt(document.getElementById('t2v_infer_steps').value),
                guidance_scale: parseFloat(document.getElementById('t2v_guidance_scale').value),
                seed: parseInt(document.getElementById('t2v_seed').value)
            };

            try {
                const response = await fetch('/.netlify/functions/replicate-t2v-generate-video', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                const data = await response.json();
                if (!response.ok) throw new Error(data.error || 'Failed to generate video');

                resultContent.innerHTML = `
                    <div class="success">
                        <strong>Success!</strong> Video generated via ${data.provider || 'Replicate'}
                        ${data.cost ? `<br><strong>Cost:</strong> ${data.cost}` : ''}
                    </div>
                    <div style="margin-top: 20px; text-align: center;">
                        <video controls class="result-video" style="max-width: 100%;">
                            <source src="${data.video}" type="video/mp4">
                        </video>
                        <p style="margin-top: 10px;">
                            <a href="${data.video}" download style="color: #667eea; font-weight: 600;">Download Video</a>
                        </p>
                    </div>
                `;
            } catch (error) {
                resultContent.innerHTML = `<div class="error"><strong>Error:</strong> ${error.message}</div>`;
            } finally {
                generateBtn.disabled = false;
                generateBtn.textContent = 'Generate Video with Replicate (~$1.25)';
            }
        });

        // Handle RunPod I2V form submission with async polling
        document.getElementById('videoI2vRunpodForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const generateBtn = document.getElementById('videoI2vRunpodGenerateBtn');
            const resultSection = document.getElementById('resultSection');
            const resultContent = document.getElementById('resultContent');

            generateBtn.disabled = true;
            generateBtn.textContent = 'Starting...';
            resultSection.style.display = 'block';
            resultContent.innerHTML = '<div class="loading"><div class="spinner"></div>Starting video generation on RunPod...</div>';

            const formData = {
                image_url: document.getElementById('runpod_image_url').value,
                prompt: document.getElementById('runpod_prompt').value,
                negative_prompt: document.getElementById('runpod_negative_prompt').value,
                model: document.getElementById('runpod_model').value,
                num_frames: parseInt(document.getElementById('runpod_num_frames').value),
                resolution: document.getElementById('runpod_resolution').value,
                fps: parseInt(document.getElementById('runpod_fps').value),
                guidance_scale: parseFloat(document.getElementById('runpod_guidance_scale').value),
                motion_bucket_id: parseInt(document.getElementById('runpod_motion_intensity').value),
                steps: parseInt(document.getElementById('runpod_steps').value),
                seed: parseInt(document.getElementById('runpod_seed').value)
            };

            try {
                // Start the job
                const response = await fetch('/.netlify/functions/runpod-generate-video', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                const data = await response.json();
                if (!response.ok && response.status !== 202) {
                    throw new Error(data.error || 'Failed to start video generation');
                }

                if (data.status === 'processing' && data.jobId) {
                    // Job started successfully, now poll for completion
                    const startTime = Date.now();
                    resultContent.innerHTML = '<div class="loading"><div class="spinner"></div>Generating video...<br><small>Elapsed: 0s | Est: 2-8 minutes (varies by frames/steps)</small></div>';
                    generateBtn.textContent = 'Generating...';

                    // Poll every 3 seconds
                    const pollInterval = 3000;
                    const maxWaitTime = 600000; // 10 minutes max (video generation can take longer)

                    const pollStatus = async () => {
                        const elapsedSeconds = Math.floor((Date.now() - startTime) / 1000);

                        if (Date.now() - startTime > maxWaitTime) {
                            throw new Error('Video generation timed out after 10 minutes. Check RunPod dashboard or try with fewer frames/steps.');
                        }

                        const statusResponse = await fetch(`/.netlify/functions/runpod-check-status?jobId=${data.jobId}`);
                        const statusData = await statusResponse.json();

                        if (statusData.status === 'completed') {
                            // Success!
                            resultContent.innerHTML = `
                                <div class="success">
                                    <strong>Success!</strong> Video generated via ${statusData.provider || 'RunPod'}
                                    ${statusData.cost ? `<br><strong>Cost:</strong> ${statusData.cost}` : ''}
                                    <br><strong>Time:</strong> ${elapsedSeconds}s
                                </div>
                                <div style="margin-top: 20px; text-align: center;">
                                    <video controls class="result-video" style="max-width: 100%;">
                                        <source src="${statusData.video}" type="video/mp4">
                                    </video>
                                    <p style="margin-top: 10px;">
                                        <a href="${statusData.video}" download style="color: #667eea; font-weight: 600;">Download Video</a>
                                    </p>
                                </div>
                            `;
                            generateBtn.disabled = false;
                            generateBtn.textContent = 'Generate Video with RunPod (~$0.02)';
                        } else if (statusData.status === 'failed') {
                            throw new Error(statusData.details || 'Video generation failed');
                        } else {
                            // Still processing, poll again
                            const progress = Math.min(Math.floor((elapsedSeconds / 300) * 100), 95); // Cap at 95% until complete (based on 5min avg)
                            const statusText = statusData.status === 'IN_QUEUE' ? 'In queue...' : 'Generating video...';
                            const elapsedMinutes = Math.floor(elapsedSeconds / 60);
                            const remainingSeconds = elapsedSeconds % 60;
                            const timeDisplay = elapsedMinutes > 0 ? `${elapsedMinutes}m ${remainingSeconds}s` : `${elapsedSeconds}s`;
                            resultContent.innerHTML = `
                                <div class="loading">
                                    <div class="spinner"></div>
                                    ${statusText}
                                    <br><small>Elapsed: ${timeDisplay} | Progress: ~${progress}% | This can take 2-8 minutes</small>
                                </div>
                            `;
                            setTimeout(pollStatus, pollInterval);
                        }
                    };

                    // Start polling
                    setTimeout(pollStatus, pollInterval);
                } else {
                    throw new Error('Unexpected response from server');
                }
            } catch (error) {
                resultContent.innerHTML = `<div class="error"><strong>Error:</strong> ${error.message}</div>`;
                generateBtn.disabled = false;
                generateBtn.textContent = 'Generate Video with RunPod (~$0.02)';
            }
        });

        // Handle Text-to-Video with Traits form submission
        document.getElementById('videoT2vTraitsForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const generateBtn = document.getElementById('videoT2vTraitsGenerateBtn');
            const resultSection = document.getElementById('resultSection');
            const resultContent = document.getElementById('resultContent');

            generateBtn.disabled = true;
            generateBtn.textContent = 'Generating...';
            resultSection.style.display = 'block';
            resultContent.innerHTML = '<div class="loading"><div class="spinner"></div>Step 1: Generating image from traits...<br><small>This may take 30-60 seconds</small></div>';

            const formData = {
                companionName: document.getElementById('traits_name').value || 'Companion',
                hairColor: document.getElementById('traits_hair_color').value,
                hairLength: document.getElementById('traits_hair_length').value,
                ethnicity: document.getElementById('traits_ethnicity').value,
                bodyType: document.getElementById('traits_body_type').value,
                age: parseInt(document.getElementById('traits_age').value),
                action: document.getElementById('traits_action').value,
                setting: document.getElementById('traits_setting').value,
                style: document.getElementById('traits_style').value,
                provider: document.getElementById('traits_provider').value,
                duration: document.getElementById('traits_duration').value,
                aspect_ratio: document.getElementById('traits_aspect_ratio').value,
                negative_prompt: document.getElementById('traits_negative_prompt').value,
                // Advanced motion controls (Replicate only)
                video_length: parseInt(document.getElementById('traits_video_length').value),
                infer_steps: parseInt(document.getElementById('traits_infer_steps').value),
                guidance_scale: parseFloat(document.getElementById('traits_guidance_scale').value),
                fps: parseInt(document.getElementById('traits_fps').value)
            };

            try {
                const startTime = Date.now();
                console.log('Generating video from traits:', formData);

                // Call the companion T2V function
                const response = await fetch('/.netlify/functions/generate-companion-t2v', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                const data = await response.json();

                if (!response.ok && response.status !== 202) {
                    throw new Error(data.error || data.message || 'Failed to generate video');
                }

                // If provider returns jobId, poll for completion (RunPod, Replicate, or Fal.ai)
                if (data.jobId) {
                    const isReplicate = formData.provider === 'replicate';
                    const isFal = formData.provider === 'fal';
                    const isRunpod = formData.provider === 'runpod';

                    const providerName = isReplicate ? 'Replicate (Hunyuan)' : isFal ? 'Fal.ai (Kling)' : 'RunPod';
                    const estimatedTime = isReplicate ? '2-5 minutes' : isFal ? '1-3 minutes' : '60-120s';

                    resultContent.innerHTML = `
                        <div class="loading">
                            <div class="spinner"></div>
                            ${isRunpod ? 'Step 2: Converting to video with ' + providerName + '...' : 'Generating video with ' + providerName + '...'}
                            <br><small>Elapsed: 0s | Est: ${estimatedTime}</small>
                            ${data.sourceImage ? `<br><small>Source image: <a href="${data.sourceImage}" target="_blank">View</a></small>` : ''}
                        </div>
                    `;
                    generateBtn.textContent = isRunpod ? 'Converting to video...' : 'Generating video...';

                    // Poll for completion
                    const pollInterval = 3000;
                    const maxWaitTime = isReplicate ? 600000 : isFal ? 600000 : 600000; // 10 min for all providers

                    const pollStatus = async () => {
                        const elapsedSeconds = Math.floor((Date.now() - startTime) / 1000);

                        if (Date.now() - startTime > maxWaitTime) {
                            throw new Error(`Video generation timed out after ${maxWaitTime / 60000} minutes`);
                        }

                        // All providers now use GET with query params
                        let statusResponse;
                        if (isFal) {
                            statusResponse = await fetch(`/.netlify/functions/fal-check-status?requestId=${data.jobId}`);
                        } else if (isReplicate) {
                            statusResponse = await fetch(`/.netlify/functions/replicate-check-status?predictionId=${data.jobId}`);
                        } else {
                            statusResponse = await fetch(`/.netlify/functions/runpod-check-status?jobId=${data.jobId}`);
                        }

                        const statusData = await statusResponse.json();

                        if (statusData.status === 'completed') {
                            resultContent.innerHTML = `
                                <div class="success">
                                    <strong>Success!</strong> Video generated from companion traits!
                                    <br><strong>Provider:</strong> ${statusData.provider || data.provider}
                                    ${statusData.cost ? `<br><strong>Cost:</strong> ${statusData.cost}` : ''}
                                    <br><strong>Time:</strong> ${elapsedSeconds}s
                                </div>
                                <div style="margin-top: 20px; text-align: center;">
                                    ${data.sourceImage ? `
                                        <div style="margin-bottom: 15px;">
                                            <p style="font-weight: 600; margin-bottom: 5px;">Source Image:</p>
                                            <img src="${data.sourceImage}" style="max-width: 300px; border-radius: 8px;">
                                        </div>
                                    ` : ''}
                                    <p style="font-weight: 600; margin-bottom: 5px;">Generated Video:</p>
                                    <video controls class="result-video" style="max-width: 100%;">
                                        <source src="${statusData.video}" type="video/mp4">
                                    </video>
                                    <p style="margin-top: 10px;">
                                        <a href="${statusData.video}" download style="color: #667eea; font-weight: 600;">Download Video</a>
                                    </p>
                                </div>
                            `;
                            generateBtn.disabled = false;
                            generateBtn.textContent = 'Generate Video from Traits';
                        } else if (statusData.status === 'failed') {
                            throw new Error(statusData.details || statusData.error || 'Video generation failed');
                        } else {
                            // Still processing
                            const expectedTime = isReplicate ? 300 : isFal ? 180 : 120; // 5 min Replicate, 3 min Fal, 2 min RunPod
                            const progress = Math.min(Math.floor((elapsedSeconds / expectedTime) * 100), 95);
                            const elapsedMinutes = Math.floor(elapsedSeconds / 60);
                            const remainingSeconds = elapsedSeconds % 60;
                            const timeDisplay = elapsedMinutes > 0 ? `${elapsedMinutes}m ${remainingSeconds}s` : `${elapsedSeconds}s`;

                            let statusText;
                            if (isReplicate) {
                                statusText = 'Generating video with Hunyuan...';
                            } else if (isFal) {
                                statusText = 'Generating video with Kling AI...';
                            } else {
                                statusText = 'Step 2: Converting to video...';
                            }

                            resultContent.innerHTML = `
                                <div class="loading">
                                    <div class="spinner"></div>
                                    ${statusText}
                                    <br><small>Elapsed: ${timeDisplay} | Progress: ~${progress}%</small>
                                    ${data.sourceImage ? `<br><small>Source: <a href="${data.sourceImage}" target="_blank">View image</a></small>` : ''}
                                </div>
                            `;
                            setTimeout(pollStatus, pollInterval);
                        }
                    };

                    setTimeout(pollStatus, pollInterval);
                } else if (data.video) {
                    // Direct video URL (fal.ai or Replicate)
                    const elapsedSeconds = Math.floor((Date.now() - startTime) / 1000);
                    resultContent.innerHTML = `
                        <div class="success">
                            <strong>Success!</strong> Video generated from companion traits!
                            <br><strong>Provider:</strong> ${data.provider}
                            ${data.cost ? `<br><strong>Cost:</strong> ${data.cost}` : ''}
                            <br><strong>Time:</strong> ${elapsedSeconds}s
                        </div>
                        <div style="margin-top: 20px; text-align: center;">
                            <video controls class="result-video" style="max-width: 100%;">
                                <source src="${data.video}" type="video/mp4">
                            </video>
                            <p style="margin-top: 10px;">
                                <a href="${data.video}" download style="color: #667eea; font-weight: 600;">Download Video</a>
                            </p>
                        </div>
                    `;
                    generateBtn.disabled = false;
                    generateBtn.textContent = 'Generate Video from Traits';
                } else {
                    throw new Error('Unexpected response: no video or job ID returned');
                }

            } catch (error) {
                console.error('T2V Traits error:', error);
                resultContent.innerHTML = `<div class="error"><strong>Error:</strong> ${error.message}</div>`;
                generateBtn.disabled = false;
                generateBtn.textContent = 'Generate Video from Traits';
            }
        });

        // Quick test functions
        async function testMaleCompanion() {
            const testData = {
                customPrompt: 'beautiful woman alone, different angle looking over shoulder, full body visible, solo portrait, professional portrait, elegant, tasteful, single person only',
                characterName: 'Test Male',
                sex: 'male',
                ethnicity: 'indian',
                hairColor: 'red',
                hairLength: 'short',
                style: 'realistic',
                shotType: 'portrait',
                uncensored: true,
                source: 'avatar-2-bulk-generation'
            };
            await testCompanion(testData, 'Indian Male with Red Hair (Short)');
        }

        async function testFemaleCompanion() {
            const testData = {
                customPrompt: 'beautiful woman alone, different angle looking over shoulder, full body visible, solo portrait, professional portrait, elegant, tasteful, single person only',
                characterName: 'Test Female',
                sex: 'female',
                ethnicity: 'black',
                hairColor: 'blonde',
                hairLength: 'long',
                style: 'realistic',
                shotType: 'portrait',
                uncensored: true,
                source: 'avatar-2-bulk-generation'
            };
            await testCompanion(testData, 'Black Female with Blonde Hair (Long)');
        }

        async function testCompanion(testData, description) {
            const resultSection = document.getElementById('resultSection');
            const resultContent = document.getElementById('resultContent');

            resultSection.style.display = 'block';
            resultContent.innerHTML = `<div class="loading"><div class="spinner"></div>Testing: ${description}...</div>`;

            try {
                console.log('Testing companion:', testData);

                const response = await fetch('/.netlify/functions/selira-generate-custom-image', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(testData)
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || 'Failed to generate image');
                }

                console.log('Response:', data);

                resultContent.innerHTML = `
                    <div class="success">
                        <strong>Success!</strong> Generated image for ${description}
                        <br><strong>Provider:</strong> ${data.provider || 'unknown'}
                    </div>
                    <div style="margin-top: 20px;">
                        <h3>Expected Traits:</h3>
                        <ul>
                            <li><strong>Sex:</strong> ${testData.sex}</li>
                            <li><strong>Ethnicity:</strong> ${testData.ethnicity}</li>
                            <li><strong>Hair Color:</strong> ${testData.hairColor}</li>
                            <li><strong>Hair Length:</strong> ${testData.hairLength}</li>
                        </ul>
                    </div>
                    <div style="margin-top: 20px; text-align: center;">
                        <img src="${data.imageUrl}" alt="Generated image" class="result-image">
                        <p style="margin-top: 10px; font-size: 12px; color: #666;">
                            <strong>Verify:</strong> Does this image match the expected traits above?
                        </p>
                    </div>
                `;

            } catch (error) {
                console.error('Error:', error);
                resultContent.innerHTML = `
                    <div class="error">
                        <strong>Error:</strong> ${error.message}
                    </div>
                `;
            }
        }

        // Update slider values
        document.getElementById('detail').addEventListener('input', (e) => {
            document.getElementById('detailValue').textContent = e.target.value;
        });

        document.getElementById('age_slider').addEventListener('input', (e) => {
            document.getElementById('ageValue').textContent = e.target.value;
        });

        document.getElementById('weight_slider').addEventListener('input', (e) => {
            document.getElementById('weightValue').textContent = e.target.value;
        });

        document.getElementById('breast_slider').addEventListener('input', (e) => {
            document.getElementById('breastValue').textContent = e.target.value;
        });

        document.getElementById('ass_slider').addEventListener('input', (e) => {
            document.getElementById('assValue').textContent = e.target.value;
        });

        // Build appearance string from companion traits
        function buildAppearanceString() {
            const sex = document.getElementById('companion_sex').value;
            const ethnicity = document.getElementById('companion_ethnicity').value;
            const hairColor = document.getElementById('companion_hair_color').value;
            const hairLength = document.getElementById('companion_hair_length').value;

            if (!sex && !ethnicity && !hairColor && !hairLength) {
                return '';
            }

            const parts = [];

            // Gender base
            if (sex === 'male') {
                parts.push('handsome man, masculine physique, strong features');
            } else if (sex === 'female') {
                parts.push('beautiful woman, feminine physique, attractive features');
            }

            // Ethnicity
            const ethnicityMap = {
                'white': 'Caucasian features, pale skin',
                'black': 'Black African American, DARK BROWN SKIN TONE, African features',
                'asian': 'East Asian features, light Asian skin',
                'indian': 'South Asian features, brown skin',
                'latina': 'Latina features, tan skin',
                'middle-eastern': 'Middle Eastern features, olive skin',
                'mixed': 'mixed ethnicity features'
            };
            if (ethnicity && ethnicityMap[ethnicity]) {
                parts.push(ethnicityMap[ethnicity]);
            }

            // Hair (skip if bald)
            if (hairLength !== 'bald') {
                if (hairColor && hairLength) {
                    parts.push(`${hairLength} ${hairColor} hair`);
                } else if (hairColor) {
                    parts.push(`${hairColor} hair`);
                } else if (hairLength) {
                    parts.push(`${hairLength} hair`);
                }
            } else if (hairLength === 'bald') {
                parts.push('bald head, shaved head');
            }

            return parts.join(', ');
        }

        // Handle form submission
        document.getElementById('generateForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const generateBtn = document.getElementById('generateBtn');
            const resultSection = document.getElementById('resultSection');
            const resultContent = document.getElementById('resultContent');

            // Disable button and show loading
            generateBtn.disabled = true;
            generateBtn.textContent = 'Generating...';
            resultSection.style.display = 'block';
            resultContent.innerHTML = '<div class="loading"><div class="spinner"></div>Generating your image...</div>';

            // Build prompt with companion traits if enabled
            let finalPrompt = document.getElementById('prompt').value;
            const useTraits = document.getElementById('use_companion_traits').checked;

            if (useTraits) {
                const appearance = buildAppearanceString();
                if (appearance) {
                    finalPrompt = `${appearance}, ${finalPrompt}`;
                    console.log('Enhanced prompt with traits:', finalPrompt);
                }
            }

            // Collect form data
            const formData = {
                prompt: finalPrompt,
                negative_prompt: document.getElementById('negative_prompt').value || undefined,
                style: document.getElementById('style').value,
                filter: document.getElementById('filter').value,
                quality: document.getElementById('quality').value,
                image_size: document.getElementById('image_size').value,
                emotion: document.getElementById('emotion').value,
                creativity: parseInt(document.getElementById('creativity').value),
                detail: parseFloat(document.getElementById('detail').value),
                age_slider: parseInt(document.getElementById('age_slider').value),
                weight_slider: parseFloat(document.getElementById('weight_slider').value),
                breast_slider: parseFloat(document.getElementById('breast_slider').value),
                ass_slider: parseFloat(document.getElementById('ass_slider').value),
                seed: parseInt(document.getElementById('seed').value),
                restore_faces: document.getElementById('restore_faces').checked
            };

            try {
                console.log('Sending request with data:', formData);

                const response = await fetch('/.netlify/functions/promptchan-generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || 'Failed to generate image');
                }

                console.log('Response:', data);

                // Display success
                resultContent.innerHTML = `
                    <div class="success">
                        <strong>Success!</strong> Image generated using ${data.gems} gems.
                    </div>
                    <div style="margin-top: 20px; text-align: center;">
                        <img src="${data.image}" alt="Generated image" class="result-image">
                    </div>
                `;

            } catch (error) {
                console.error('Error:', error);
                resultContent.innerHTML = `
                    <div class="error">
                        <strong>Error:</strong> ${error.message}
                    </div>
                `;
            } finally {
                // Re-enable button
                generateBtn.disabled = false;
                generateBtn.textContent = 'Generate Image';
            }
        });
    </script>
</body>
</html>
