<!DOCTYPE html>
<html>
<head>
    <title>Subscription Test</title>
</head>
<body>
    <h1>Manual Subscription Test</h1>

    <div>
        <h3>Step 1: Test Subscription Info</h3>
        <input type="email" id="testEmail" placeholder="Enter user email" value="">
        <button onclick="testSubscriptionInfo()">Test Current Subscription</button>
        <div id="currentResult"></div>
    </div>

    <div style="margin-top: 20px;">
        <h3>Step 2: Simulate Webhook Update</h3>
        <p>Go to your Airtable and manually update a user record with:</p>
        <ul>
            <li><strong>Plan:</strong> Basic</li>
            <li><strong>stripe_customer_id:</strong> cus_test_123</li>
            <li><strong>stripe_subscription_id:</strong> sub_test_123</li>
            <li><strong>subscription_status:</strong> active</li>
            <li><strong>plan_start_date:</strong> today's date</li>
        </ul>
        <button onclick="testAfterUpdate()">Test After Manual Update</button>
        <div id="afterResult"></div>
    </div>

    <script>
        async function testSubscriptionInfo() {
            const email = document.getElementById('testEmail').value;
            if (!email) {
                alert('Please enter an email');
                return;
            }

            const resultDiv = document.getElementById('currentResult');
            resultDiv.innerHTML = 'Testing...';

            try {
                const response = await fetch(`https://selira.ai/.netlify/functions/selira-get-subscription-info?email=${encodeURIComponent(email)}`);
                const data = await response.json();

                resultDiv.innerHTML = `
                    <h4>Current Subscription Info:</h4>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
            }
        }

        async function testAfterUpdate() {
            const email = document.getElementById('testEmail').value;
            if (!email) {
                alert('Please enter an email first');
                return;
            }

            const resultDiv = document.getElementById('afterResult');
            resultDiv.innerHTML = 'Testing updated subscription...';

            try {
                const response = await fetch(`https://selira.ai/.netlify/functions/selira-get-subscription-info?email=${encodeURIComponent(email)}`);
                const data = await response.json();

                resultDiv.innerHTML = `
                    <h4>Updated Subscription Info:</h4>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                    <p><strong>Plan should now be:</strong> ${data.subscription?.plan || 'Not found'}</p>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
            }
        }
    </script>
</body>
</html>