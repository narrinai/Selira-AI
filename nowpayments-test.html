<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NOWPayments Integration Test - Selira AI</title>
  <style>
    :root {
      --bg-primary: #0a0a0a;
      --bg-secondary: #1a1a1a;
      --bg-tertiary: #2a2a2a;
      --text-primary: #ffffff;
      --text-secondary: #b3b3b3;
      --accent: #ce93d8;
      --accent-hover: #ba68c8;
      --border: #333333;
      --radius-md: 12px;
      --radius-lg: 16px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background-color: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      padding: 40px 20px;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
    }

    h1 {
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 16px;
      color: var(--accent);
      text-align: center;
    }

    .description {
      text-align: center;
      color: var(--text-secondary);
      margin-bottom: 40px;
      font-size: 14px;
    }

    .test-section {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: 32px;
      margin-bottom: 24px;
    }

    .test-section h2 {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 16px;
      color: var(--text-primary);
    }

    .test-section p {
      color: var(--text-secondary);
      font-size: 14px;
      margin-bottom: 20px;
    }

    .payment-buttons {
      display: flex;
      flex-direction: column;
      gap: 20px;
      margin-top: 24px;
    }

    .payment-option {
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      padding: 24px;
    }

    .payment-option h3 {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 8px;
      color: var(--text-primary);
    }

    .payment-option .price {
      font-size: 24px;
      font-weight: 700;
      color: var(--accent);
      margin-bottom: 16px;
    }

    .payment-option ul {
      list-style: none;
      margin-bottom: 20px;
    }

    .payment-option li {
      padding: 8px 0;
      color: var(--text-secondary);
      font-size: 14px;
    }

    .payment-option li::before {
      content: "‚úì ";
      color: #10b981;
      font-weight: bold;
      margin-right: 8px;
    }

    /* NOWPayments button styling */
    .crypto-payment-btn {
      width: 100%;
      padding: 14px 24px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: var(--radius-md);
      font-weight: 600;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
      text-align: center;
      display: block;
      margin-top: 12px;
    }

    .crypto-payment-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 16px rgba(102, 126, 234, 0.3);
    }

    .info-box {
      background: rgba(206, 147, 216, 0.1);
      border: 1px solid rgba(206, 147, 216, 0.2);
      border-radius: var(--radius-md);
      padding: 16px;
      margin-top: 24px;
    }

    .info-box h4 {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 8px;
      color: var(--accent);
    }

    .info-box p {
      font-size: 12px;
      color: var(--text-secondary);
      margin-bottom: 0;
    }

    code {
      background: var(--bg-tertiary);
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 12px;
      color: var(--accent);
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üöÄ NOWPayments Integration Test</h1>
    <p class="description">Test crypto payment buttons voor Selira AI premium plans - API Integration Active</p>

    <!-- Instructions -->
    <div class="test-section">
      <h2>‚úÖ Klaar om te testen!</h2>
      <p style="color: var(--accent); font-weight: 600;">Alle payment links zijn geconfigureerd - klik op een button om te testen!</p>
      <p>De buttons openen direct de NOWPayments checkout pagina waar je kunt betalen met verschillende cryptocurrencies.</p>
      <div style="background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.2); border-radius: 8px; padding: 12px; margin-top: 12px;">
        <p style="margin: 0; font-size: 13px;"><strong>üí° Tip:</strong> Voor een testbetaling kun je een kleine cryptocurrency betaling doen om de flow te testen.</p>
      </div>
    </div>

    <!-- Payment Options -->
    <div class="test-section">
      <h2>üí≥ Test Payment Buttons</h2>
      <p>Klik op een button om de crypto payment flow te testen:</p>

      <div class="payment-buttons">
        <!-- Light Plan -->
        <div class="payment-option">
          <h3>Light Plan</h3>
          <div class="price">$5.99/maand</div>
          <ul>
            <li>Unlimited messaging</li>
            <li>Unlimited companions</li>
            <li>5 images per uur</li>
          </ul>

          <!-- Method 1: Simple Payment Link -->
          <a href="#" class="crypto-payment-btn" onclick="openNOWPaymentsCheckout('light'); return false;">
            üí∞ Betaal met Crypto (Light)
          </a>
        </div>

        <!-- Basic Plan -->
        <div class="payment-option">
          <h3>Basic Plan</h3>
          <div class="price">$9.99/maand</div>
          <ul>
            <li>Unlimited messaging</li>
            <li>Unlimited companions</li>
            <li>10 images per uur</li>
          </ul>

          <a href="#" class="crypto-payment-btn" onclick="openNOWPaymentsCheckout('basic'); return false;">
            üí∞ Betaal met Crypto (Basic)
          </a>
        </div>

        <!-- Premium Plan -->
        <div class="payment-option">
          <h3>Premium Plan</h3>
          <div class="price">$19.99/maand</div>
          <ul>
            <li>Unlimited messaging</li>
            <li>Unlimited companions</li>
            <li>20 images per uur</li>
            <li>Special companions</li>
          </ul>

          <a href="#" class="crypto-payment-btn" onclick="openNOWPaymentsCheckout('premium'); return false;">
            üí∞ Betaal met Crypto (Premium)
          </a>
        </div>
      </div>
    </div>

    <!-- Info Box -->
    <div class="info-box">
      <h4>üìã Volgende Stappen voor Productie</h4>
      <p><strong>1. Integratie in pricing.html:</strong> Voeg crypto payment buttons toe onder de bestaande Stripe buttons</p>
      <p style="margin-top: 8px;"><strong>2. Webhook Setup:</strong> Maak een Netlify Function die NOWPayments IPN (Instant Payment Notifications) ontvangt om:</p>
      <ul style="margin-left: 20px; margin-top: 8px; font-size: 12px;">
        <li>Payment status te verifi√´ren (paid/confirmed)</li>
        <li>Image credits toe te voegen aan de gebruiker in Airtable</li>
        <li>Gebruiker een bevestigingsmail te sturen</li>
      </ul>
      <p style="margin-top: 12px;"><strong>3. IPN Secret:</strong> Sla je NOWPayments IPN Secret op in Netlify environment variables voor webhook verificatie</p>
    </div>
  </div>

  <script>
    // ‚ö†Ô∏è CONFIGURATION REQUIRED ‚ö†Ô∏è
    // Vul hier je NOWPayments credentials in
    const NOWPAYMENTS_CONFIG = {
      apiKey: 'YOUR_API_KEY_HERE', // Vul je API key in van https://account.nowpayments.io/settings/api-keys
      ipnSecret: 'YOUR_IPN_SECRET_HERE', // Optioneel: voor webhook verification

      // Plan prices in USD
      plans: {
        light: {
          name: 'Light Pack (50 credits)',
          price: 5.99,
          paymentLink: null // Using API instead
        },
        basic: {
          name: 'Basic Pack (100 credits)',
          price: 9.99,
          paymentLink: null // Using API instead
        },
        premium: {
          name: 'Premium Pack (250 credits)',
          price: 19.99,
          paymentLink: null // Using API instead
        }
      }
    };

    // Method 1: Open NOWPayments checkout (using payment links)
    function openNOWPaymentsCheckout(planType) {
      const plan = NOWPAYMENTS_CONFIG.plans[planType];

      if (!plan) {
        alert('Invalid plan type');
        return;
      }

      console.log('üöÄ Opening NOWPayments checkout for:', plan.name);

      // Check if payment link is configured
      if (plan.paymentLink) {
        // Open the pre-configured payment link
        window.open(plan.paymentLink, '_blank');
      } else {
        // If no payment link: create payment via API
        createNOWPayment(planType);
      }
    }

    // Method 2: Create payment via NOWPayments API
    async function createNOWPayment(planType) {
      const plan = NOWPAYMENTS_CONFIG.plans[planType];

      console.log('üí≥ Creating NOWPayments payment for:', plan.name);

      // Show loading indicator
      const button = event.target;
      const originalText = button.textContent;
      button.textContent = '‚è≥ Creating payment...';
      button.disabled = true;

      try {
        // Get user info (from your auth system)
        const userEmail = localStorage.getItem('user_email') || 'test@example.com';
        const userId = localStorage.getItem('user_uid') || 'test_user_' + Date.now();

        console.log('üë§ User info:', { userEmail, userId });

        // Call backend Netlify Function to create invoice
        const response = await fetch('/.netlify/functions/create-nowpayments-invoice', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            planType: planType,
            userEmail: userEmail,
            userId: userId
          })
        });

        const result = await response.json();

        console.log('üìä Response:', result);

        if (!response.ok) {
          console.error('‚ùå Full error response:', result);
          throw new Error(result.details || result.error || 'Failed to create payment');
        }

        if (result.invoice_url) {
          console.log('‚úÖ Redirecting to payment page:', result.invoice_url);
          // Redirect to NOWPayments checkout
          window.location.href = result.invoice_url;
        } else {
          throw new Error('No invoice URL received');
        }

      } catch (error) {
        console.error('‚ùå Error creating payment:', error);
        alert(`‚ùå Error: ${error.message}\n\nCheck console for details.`);

        // Restore button
        button.textContent = originalText;
        button.disabled = false;
      }
    }

    // Log configuration on page load
    console.log('‚úÖ NOWPayments API Integration Ready');
    console.log('üìã Using Netlify Functions for payment processing');
  </script>

  <!-- Optional: NOWPayments Widget Integration -->
  <!-- Als je hun hosted widget wilt gebruiken, uncomment dit: -->
  <!--
  <script src="https://nowpayments.io/embeds/button.js"></script>
  <div id="np-button-container"></div>
  <script>
    window.addEventListener('load', () => {
      const button = document.createElement('button');
      button.id = 'np-button';
      button.className = 'nowpayments-button';
      button.setAttribute('data-np-amount', '9.99');
      button.setAttribute('data-np-currency', 'usd');
      button.setAttribute('data-np-pay-currency', 'btc');
      button.setAttribute('data-np-order-id', 'ORDER-12345');
      button.setAttribute('data-np-order-description', 'Selira AI Basic Plan');
      button.textContent = 'Pay with Crypto';

      document.getElementById('np-button-container').appendChild(button);

      // Initialize NOWPayments button
      if (window.NOWPaymentsButton) {
        window.NOWPaymentsButton.init();
      }
    });
  </script>
  -->
</body>
</html>
