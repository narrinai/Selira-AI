<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chat with AI Companions | Selira AI</title>
  <meta name="description" content="Engage in meaningful conversations with AI companions. Experience intelligent, empathetic, and personalized interactions.">
  
  <!-- Auth0 Authentication System -->
  <script src="/js/auth0-login.js"></script>
  
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Nunito:wght@300;400;500;600;700&display=swap');
    
    :root {
      /* Selira dark theme - matching index.html */
      --bg-primary: #0a0a0a;
      --bg-secondary: #1a1a1a;
      --bg-tertiary: #2a2a2a;
      --text-primary: #ffffff;
      --text-secondary: #b3b3b3;
      --text-muted: #888888;
      --accent: #d4a574;
      --accent-hover: #c19456;
      --accent-secondary: #ec4899;
      --border: #333333;
      --success: #10b981;
      --error: #ef4444;
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Nunito', -apple-system, BlinkMacSystemFont, sans-serif;
      background-color: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      overflow: hidden;
    }

    /* App Layout */
    .app-container {
      display: flex;
      height: 100vh;
      overflow: hidden;
    }

    /* Left Sidebar with Character List */
    .sidebar {
      width: 220px;
      background: var(--bg-secondary);
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .sidebar-header {
      padding: 16px;
      border-bottom: 1px solid var(--border);
    }

    .sidebar-logo {
      display: flex;
      align-items: center;
      gap: 8px;
      text-decoration: none;
      margin-bottom: 16px;
    }

    .logo-icon {
      width: 28px;
      height: 28px;
      background: linear-gradient(135deg, var(--accent), var(--accent-secondary));
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: 700;
      color: white;
    }

    .logo-text {
      font-family: 'Playfair Display', serif;
      font-size: 18px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .new-chat-btn {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 12px;
      background: var(--accent);
      color: white;
      border: none;
      border-radius: var(--radius-md);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .new-chat-btn:hover {
      background: var(--accent-hover);
    }

    .sidebar-section {
      flex: 1;
      overflow-y: auto;
    }

    .section-header {
      padding: 16px 16px 8px;
      font-size: 10px;
      font-weight: 700;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .chat-list {
      padding: 0 8px;
    }

    .chat-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 8px;
      margin-bottom: 2px;
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .chat-item:hover, .chat-item.active {
      background: var(--bg-tertiary);
    }

    .chat-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      overflow: hidden;
      flex-shrink: 0;
    }

    .chat-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .chat-info {
      flex: 1;
      min-width: 0;
    }

    .chat-name {
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 2px;
      font-size: 12px;
    }

    .chat-preview {
      color: var(--text-secondary);
      font-size: 10px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    /* Main Chat Area */
    .chat-main {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    /* Chat Header */
    .chat-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px;
      border-bottom: 1px solid var(--border);
      background: var(--bg-secondary);
    }

    .character-info-header {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .character-avatar-header {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      overflow: hidden;
      border: 2px solid var(--accent);
    }

    .character-avatar-header img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .character-name-header {
      font-family: 'Playfair Display', serif;
      font-size: 20px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 4px;
    }

    .character-status {
      color: var(--text-secondary);
      font-size: 14px;
    }

    .chat-actions {
      display: flex;
      gap: 8px;
    }

    .action-btn {
      width: 40px;
      height: 40px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }

    .action-btn:hover {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
    }

    /* Right Sidebar Character Details */
    .character-sidebar {
      width: 320px;
      background: var(--bg-secondary);
      border-left: 1px solid var(--border);
      padding: 20px;
      overflow-y: auto;
    }

    .character-profile {
      text-align: center;
      margin-bottom: 30px;
    }

    .character-avatar-large {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      overflow: hidden;
      margin: 0 auto 16px;
      border: 3px solid var(--accent);
    }

    .character-avatar-large img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .character-name-large {
      font-family: 'Playfair Display', serif;
      font-size: 24px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 8px;
    }

    .character-creator {
      color: var(--accent);
      font-size: 14px;
      margin-bottom: 16px;
    }

    .character-description {
      color: var(--text-secondary);
      font-size: 14px;
      line-height: 1.5;
      margin-bottom: 20px;
    }

    .character-stats {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 20px;
    }

    .stat-item {
      text-align: center;
    }

    .stat-number {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .stat-label {
      font-size: 12px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .character-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 20px;
    }

    .character-tag {
      background: rgba(212, 165, 116, 0.2);
      color: var(--accent);
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
    }

    /* Chat Messages */
    .chat-messages {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
      background: var(--bg-primary);
    }

    .welcome-message {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      text-align: center;
      color: var(--text-secondary);
    }

    .welcome-icon {
      font-size: 48px;
      margin-bottom: 16px;
    }

    .welcome-message h3 {
      font-family: 'Playfair Display', serif;
      font-size: 24px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 8px;
    }

    .message-group {
      margin-bottom: 20px;
    }

    .message {
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
      max-width: 80%;
    }

    .message.user {
      flex-direction: row-reverse;
      margin-left: auto;
    }

    .message-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      overflow: hidden;
      flex-shrink: 0;
    }

    .message-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .message-content {
      background: var(--bg-secondary);
      padding: 12px 16px;
      border-radius: 18px;
      color: var(--text-primary);
      line-height: 1.4;
    }

    .message.user .message-content {
      background: var(--accent);
      color: white;
    }

    /* Chat Input */
    .chat-input-container {
      padding: 20px;
      border-top: 1px solid var(--border);
      background: var(--bg-secondary);
    }

    .chat-input-wrapper {
      display: flex;
      gap: 12px;
      align-items: flex-end;
    }

    #messageInput {
      flex: 1;
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 12px 16px;
      color: var(--text-primary);
      font-family: inherit;
      font-size: 14px;
      resize: none;
      max-height: 120px;
      overflow-y: auto;
    }

    #messageInput:focus {
      outline: none;
      border-color: var(--accent);
    }

    .send-btn {
      width: 40px;
      height: 40px;
      background: var(--accent);
      border: none;
      border-radius: 50%;
      color: white;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }

    .send-btn:hover {
      background: var(--accent-hover);
      transform: scale(1.05);
    }

    .send-btn:disabled {
      background: var(--border);
      cursor: not-allowed;
      transform: none;
    }

    .input-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 8px;
      font-size: 12px;
      color: var(--text-muted);
    }

    /* Character Search Modal */
    .search-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .search-modal.open {
      display: flex;
    }

    .modal-content {
      background: var(--bg-secondary);
      border-radius: var(--radius-lg);
      width: 90vw;
      max-width: 800px;
      max-height: 80vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px;
      border-bottom: 1px solid var(--border);
    }

    .modal-header h3 {
      font-family: 'Playfair Display', serif;
      font-size: 20px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .close-btn {
      width: 32px;
      height: 32px;
      background: none;
      border: none;
      color: var(--text-secondary);
      font-size: 24px;
      cursor: pointer;
      border-radius: var(--radius-sm);
      transition: all 0.2s ease;
    }

    .close-btn:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .search-input-wrapper {
      padding: 20px;
      border-bottom: 1px solid var(--border);
    }

    #characterSearch {
      width: 100%;
      padding: 12px 16px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      color: var(--text-primary);
      font-size: 14px;
    }

    #characterSearch:focus {
      outline: none;
      border-color: var(--accent);
    }

    .character-grid {
      padding: 20px;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 16px;
      max-height: 400px;
      overflow-y: auto;
    }

    .character-option {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      padding: 16px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: all 0.2s ease;
      text-align: center;
    }

    .character-option:hover {
      background: var(--bg-secondary);
      border-color: var(--accent);
      transform: translateY(-2px);
    }

    .character-option-avatar {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      overflow: hidden;
      border: 2px solid var(--accent);
    }

    .character-option-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .character-option-name {
      font-weight: 600;
      color: var(--text-primary);
      font-size: 14px;
    }

    .character-option-role {
      color: var(--text-secondary);
      font-size: 12px;
    }

    /* Mobile Responsive */
    @media (max-width: 768px) {
      .sidebar {
        position: fixed;
        left: -220px;
        z-index: 100;
        transition: left 0.3s ease;
      }

      .sidebar.open {
        left: 0;
      }

      .chat-main {
        margin-left: 0;
      }

      .character-sidebar {
        display: none;
      }

      .chat-header {
        padding-left: 60px;
      }

      .mobile-menu-btn {
        position: absolute;
        left: 20px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        color: var(--text-primary);
        font-size: 20px;
        cursor: pointer;
      }
    }

    /* Hide character sidebar on medium screens */
    @media (max-width: 1200px) {
      .character-sidebar {
        display: none;
      }
    }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- Left Sidebar with Character List -->
    <aside class="sidebar" id="sidebar">
      <!-- Sidebar Header -->
      <div class="sidebar-header">
        <a href="/" class="sidebar-logo">
          <span class="logo-text">Selira</span>
        </a>
        <button class="new-chat-btn" onclick="showCharacterSearch()">
          <span class="btn-icon">+</span>
          <span>New Chat</span>
        </button>
      </div>

      <!-- Recent Chats -->
      <div class="sidebar-section">
        <div class="section-header">
          <span>Today</span>
        </div>
        <div class="chat-list" id="chatList">
          <!-- Sample chat items -->
          <div class="chat-item active">
            <div class="chat-avatar">
              <img src="https://selira.ai/avatars/aiko.webp" alt="Aiko">
            </div>
            <div class="chat-info">
              <div class="chat-name">Aiko</div>
              <div class="chat-preview">Your mom's friends Claire is...</div>
            </div>
          </div>
          <div class="chat-item">
            <div class="chat-avatar">
              <img src="https://selira.ai/avatars/emily.webp" alt="Emily">
            </div>
            <div class="chat-info">
              <div class="chat-name">Emily</div>
              <div class="chat-preview">Your best friend found out...</div>
            </div>
          </div>
        </div>
      </div>
    </aside>

    <!-- Main Chat Area -->
    <main class="chat-main">
      <!-- Mobile Menu Button -->
      <button class="mobile-menu-btn" onclick="toggleSidebar()" style="display: none;">☰</button>

      <!-- Chat Header -->
      <header class="chat-header" id="chatHeader">
        <div class="character-info-header">
          <div class="character-avatar-header" id="currentCharacterAvatar">
            <img src="https://selira.ai/avatars/aiko.webp" alt="Character" id="characterImage">
          </div>
          <div class="character-details">
            <h2 class="character-name-header" id="currentCharacterName">Aiko</h2>
            <p class="character-status" id="currentCharacterStatus">@Hawkins</p>
          </div>
        </div>
        <div class="chat-actions">
          <button class="action-btn" onclick="showCharacterSearch()" title="Switch Character">
            <span>👥</span>
          </button>
          <button class="action-btn" onclick="clearChat()" title="Clear Chat">
            <span>🗑️</span>
          </button>
        </div>
      </header>

      <!-- Chat Messages Area -->
      <div class="chat-messages" id="chatMessages">
        <div class="message-group">
          <div class="message">
            <div class="message-avatar">
              <img src="https://selira.ai/avatars/aiko.webp" alt="Aiko">
            </div>
            <div class="message-content">
              <em>It was early in the morning, the sun barely rising and user was woken up by sounds of heavy boxes coming into your house. You went downstairs to see what was going on. You saw your mom and Claire helping carry boxes while Aiko just stood there, yawning since it was so early in the morning.</em>
              <br><br>
              <strong>Aiko:</strong> Mom I really didnt have to come, I could have stayed at my friends place.<br>
              <strong>Claire:</strong> Oh come on Aiko, youll be here for 6 months, plus look over there, youll have company.<br>
              <em>Claire points at user, still half-asleep.</em>
            </div>
          </div>
        </div>
      </div>

      <!-- Chat Input -->
      <div class="chat-input-container" id="chatInputContainer">
        <div class="chat-input-wrapper">
          <textarea 
            id="messageInput" 
            placeholder="Enter a message. Ex) Hello?" 
            rows="1"
            maxlength="2000"
          ></textarea>
          <button class="send-btn" id="sendBtn" onclick="sendMessage()">
            <span>➤</span>
          </button>
        </div>
        <div class="input-footer">
          <span class="character-count" id="characterCount">0/2000</span>
          <span class="input-hint">Everything AI says is made up! Please follow your local laws and don't talk about underage content.</span>
        </div>
      </div>
    </main>

    <!-- Right Sidebar Character Details -->
    <aside class="character-sidebar" id="characterSidebar">
      <div class="character-profile">
        <div class="character-avatar-large">
          <img src="https://selira.ai/avatars/aiko.webp" alt="Aiko" id="sidebarCharacterImage">
        </div>
        <h3 class="character-name-large" id="sidebarCharacterName">Aiko</h3>
        <p class="character-creator" id="sidebarCharacterCreator">@Hawkins</p>
        <p class="character-description" id="sidebarCharacterDescription">
          Your mom's friends Claire is having her house remodeled, so she asked if she could stay with you all for a while. Claire also brought her daughter, Aiko.
        </p>
        
        <div class="character-stats">
          <div class="stat-item">
            <div class="stat-number" id="sidebarCharacterChats">51.4K</div>
            <div class="stat-label">Chats</div>
          </div>
          <div class="stat-item">
            <div class="stat-number" id="sidebarCharacterRating">4.7</div>
            <div class="stat-label">Rating</div>
          </div>
        </div>
        
        <div class="character-tags" id="sidebarCharacterTags">
          <span class="character-tag">Unfiltered</span>
          <span class="character-tag">Anime</span>
          <span class="character-tag">Wholesome</span>
          <span class="character-tag">Animal</span>
          <span class="character-tag">Femboy</span>
          <span class="character-tag">MILF</span>
          <span class="character-tag">Action</span>
          <span class="character-tag">Sci-Fi</span>
          <span class="character-tag">VTuber</span>
          <span class="character-tag">Fantasy</span>
          <span class="character-tag">Female</span>
        </div>
      </div>
    </aside>

    <!-- Character Search Modal -->
    <div class="search-modal" id="searchModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Choose a Character</h3>
          <button class="close-btn" onclick="closeCharacterSearch()">×</button>
        </div>
        <div class="search-input-wrapper">
          <input type="text" id="characterSearch" placeholder="Search characters...">
        </div>
        <div class="character-grid" id="characterGrid">
          <!-- Sample characters -->
          <div class="character-option" onclick="selectCharacter('aragorn')">
            <div class="character-option-avatar">
              <img src="https://selira.ai/avatars/aragorn-1750067445.webp" alt="Aragorn">
            </div>
            <div class="character-option-name">Aragorn</div>
            <div class="character-option-role">Ranger King</div>
          </div>
          <div class="character-option" onclick="selectCharacter('harry-potter')">
            <div class="character-option-avatar">
              <img src="https://selira.ai/avatars/harry-potter-1750067058.webp" alt="Harry Potter">
            </div>
            <div class="character-option-name">Harry Potter</div>
            <div class="character-option-role">The Boy Who Lived</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Global variables
    let currentCharacter = {
      name: 'Aiko',
      slug: 'aiko',
      avatar: 'https://selira.ai/avatars/aiko.webp',
      creator: '@Hawkins',
      description: "Your mom's friends Claire is having her house remodeled, so she asked if she could stay with you all for a while. Claire also brought her daughter, Aiko.",
      chats: '51.4K',
      rating: '4.7',
      tags: ['Unfiltered', 'Anime', 'Wholesome', 'Animal', 'Femboy', 'MILF', 'Action', 'Sci-Fi', 'VTuber', 'Fantasy', 'Female']
    };

    let chatHistory = [];
    let loadedCharacters = [];

    // Initialize chat interface
    document.addEventListener('DOMContentLoaded', function() {
      console.log('🚀 Selira AI Chat interface loading...');
      loadCharactersFromDatabase();
      initializeChatInterface();
      setupEventListeners();
    });

    function initializeChatInterface() {
      // Set up character info
      updateCharacterDisplay();
      
      // Auto-resize textarea
      const messageInput = document.getElementById('messageInput');
      if (messageInput) {
        messageInput.addEventListener('input', autoResizeTextarea);
        messageInput.addEventListener('keydown', handleKeyDown);
      }
    }

    function setupEventListeners() {
      // Character count update
      const messageInput = document.getElementById('messageInput');
      const characterCount = document.getElementById('characterCount');
      
      if (messageInput && characterCount) {
        messageInput.addEventListener('input', function() {
          characterCount.textContent = `${this.value.length}/2000`;
        });
      }
    }

    function autoResizeTextarea() {
      const textarea = document.getElementById('messageInput');
      textarea.style.height = 'auto';
      textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
    }

    function handleKeyDown(e) {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    }

    function updateCharacterDisplay() {
      // Update header
      document.getElementById('currentCharacterName').textContent = currentCharacter.name;
      document.getElementById('currentCharacterStatus').textContent = currentCharacter.creator;
      document.getElementById('characterImage').src = currentCharacter.avatar;
      
      // Update sidebar
      document.getElementById('sidebarCharacterName').textContent = currentCharacter.name;
      document.getElementById('sidebarCharacterCreator').textContent = currentCharacter.creator;
      document.getElementById('sidebarCharacterDescription').textContent = currentCharacter.description;
      document.getElementById('sidebarCharacterImage').src = currentCharacter.avatar;
      document.getElementById('sidebarCharacterChats').textContent = currentCharacter.chats;
      document.getElementById('sidebarCharacterRating').textContent = currentCharacter.rating;
      
      // Update tags
      const tagsContainer = document.getElementById('sidebarCharacterTags');
      if (tagsContainer && currentCharacter.tags) {
        tagsContainer.innerHTML = currentCharacter.tags.map(tag => 
          `<span class="character-tag">${tag}</span>`
        ).join('');
      }
    }

    function showCharacterSearch() {
      document.getElementById('searchModal').classList.add('open');
      document.getElementById('characterSearch').focus();
    }

    function closeCharacterSearch() {
      document.getElementById('searchModal').classList.remove('open');
    }

    function selectCharacter(slug) {
      // Update character based on selection
      // This would normally fetch from API
      console.log('Selected character:', slug);
      closeCharacterSearch();
    }

    function sendMessage() {
      const messageInput = document.getElementById('messageInput');
      const message = messageInput.value.trim();
      
      if (!message) return;
      
      // Add user message
      addMessage(message, 'user');
      messageInput.value = '';
      autoResizeTextarea();
      
      // Simulate AI response (replace with actual API call)
      setTimeout(() => {
        addMessage("I understand! Let me help you with that.", 'ai');
      }, 1000);
    }

    function addMessage(content, sender) {
      const messagesContainer = document.getElementById('chatMessages');
      const welcomeMessage = messagesContainer.querySelector('.welcome-message');
      
      if (welcomeMessage) {
        welcomeMessage.remove();
      }
      
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${sender}`;
      
      if (sender === 'ai') {
        messageDiv.innerHTML = `
          <div class="message-avatar">
            <img src="${currentCharacter.avatar}" alt="${currentCharacter.name}">
          </div>
          <div class="message-content">${content}</div>
        `;
      } else {
        messageDiv.innerHTML = `
          <div class="message-content">${content}</div>
        `;
      }
      
      messagesContainer.appendChild(messageDiv);
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

    function clearChat() {
      const messagesContainer = document.getElementById('chatMessages');
      messagesContainer.innerHTML = `
        <div class="welcome-message">
          <div class="welcome-icon">💬</div>
          <h3>Chat Cleared</h3>
          <p>Start a new conversation with ${currentCharacter.name}!</p>
        </div>
      `;
    }

    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      sidebar.classList.toggle('open');
    }

    // Close sidebar when clicking outside on mobile
    document.addEventListener('click', function(e) {
      const sidebar = document.getElementById('sidebar');
      const mobileBtn = document.querySelector('.mobile-menu-btn');
      
      if (window.innerWidth <= 768 && 
          !sidebar.contains(e.target) && 
          !mobileBtn.contains(e.target) && 
          sidebar.classList.contains('open')) {
        sidebar.classList.remove('open');
      }
    });

    // Handle responsive design
    function handleResize() {
      const isMobile = window.innerWidth <= 768;
      const mobileBtn = document.querySelector('.mobile-menu-btn');
      
      if (mobileBtn) {
        mobileBtn.style.display = isMobile ? 'block' : 'none';
      }
    }

    window.addEventListener('resize', handleResize);
    document.addEventListener('DOMContentLoaded', handleResize);

    // ===== DATABASE INTEGRATION =====
    async function loadCharactersFromDatabase() {
      try {
        console.log('📡 Loading characters from database...');
        const response = await fetch('/.netlify/functions/characters');
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        
        if (data.success && data.characters) {
          const characters = data.characters.slice(0, 10).map(char => ({
            id: char.Character_ID || char.Name,
            name: char.Name || 'Unknown',
            title: char.Character_Title || '',
            description: char.Character_Description || '',
            avatar: char.Avatar_URL ? char.Avatar_URL.replace('narrin.ai', 'selira.ai') : null,
            category: char.Category || 'Other',
            slug: char.Slug || (char.Name ? char.Name.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-+|-+$/g, '') : 'unknown'),
            creator: char.Nickname || 'Selira',
            tags: Array.isArray(char.Tags) ? char.Tags.slice(0, 11) : (char.Tags || '').toString().split(',').filter(Boolean).slice(0, 11) // Get real tags
          }));
          
          // Store characters globally
          loadedCharacters = characters;
          
          // Update character search modal with real characters
          updateCharacterSearchModal(characters);
          
          // Update recent chats sidebar with some characters
          updateRecentChatsSidebar(characters.slice(0, 5));
          
          console.log('✅ Loaded characters from database:', characters.length);
        }
      } catch (error) {
        console.error('❌ Error loading characters:', error);
        // Keep demo data as fallback
      }
    }

    function updateCharacterSearchModal(characters) {
      const characterGrid = document.getElementById('characterGrid');
      if (!characterGrid) return;
      
      characterGrid.innerHTML = characters.map(character => `
        <div class="character-option" onclick="selectCharacter('${character.slug}', '${character.name}', '${character.avatar}', '${character.title}')">
          <div class="character-option-avatar">
            <img src="${character.avatar}" alt="${character.name}" onerror="this.style.display='none'">
          </div>
          <div class="character-option-name">${character.name}</div>
          <div class="character-option-role">${character.title}</div>
        </div>
      `).join('');
    }

    function updateRecentChatsSidebar(characters) {
      const chatList = document.getElementById('chatList');
      if (!chatList) return;
      
      chatList.innerHTML = characters.map((character, index) => `
        <div class="chat-item ${index === 0 ? 'active' : ''}" onclick="selectCharacterFromSidebar('${character.slug}', '${character.name}', '${character.avatar}', '${character.title}')">
          <div class="chat-avatar">
            <img src="${character.avatar}" alt="${character.name}" onerror="this.style.display='none'">
          </div>
          <div class="chat-info">
            <div class="chat-name">${character.name}</div>
            <div class="chat-preview">${character.description.substring(0, 30)}...</div>
          </div>
        </div>
      `).join('');
    }

    function selectCharacterFromSidebar(slug, name, avatar, title) {
      // Find character in loaded data for real tags and creator
      const character = loadedCharacters.find(c => c.slug === slug) || {};
      
      // Update current character
      currentCharacter = {
        name: name,
        slug: slug,
        avatar: avatar,
        creator: '@' + (character.creator || 'Selira'),
        description: character.description || 'Start a conversation with ' + name,
        chats: Math.floor(Math.random() * 100) + 'K',
        rating: (Math.random() * 2 + 3).toFixed(1),
        tags: character.tags || ['Fantasy', 'Adventure', 'Hero']
      };
      
      updateCharacterDisplay();
      
      // Update active chat item
      document.querySelectorAll('.chat-item').forEach(item => {
        item.classList.remove('active');
      });
      event.currentTarget.classList.add('active');
      
      // Clear chat and start fresh
      clearChat();
    }

    function selectCharacter(slug, name, avatar, title) {
      // Update character and close modal
      currentCharacter = {
        name: name,
        slug: slug,
        avatar: avatar,
        creator: '@Selira',
        description: 'Start a conversation with ' + name,
        chats: Math.floor(Math.random() * 100) + 'K',
        rating: (Math.random() * 2 + 3).toFixed(1),
        tags: ['Fantasy', 'Adventure', 'Hero']
      };
      
      updateCharacterDisplay();
      closeCharacterSearch();
      clearChat();
    }

    console.log('✅ Selira AI Chat interface initialized with modern design');
  </script>
</body>
</html>